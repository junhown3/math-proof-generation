{
  "arxiv_id": "2509.25994",
  "title": "Balanced Fibonacci word rectangles, and beyond",
  "authors": [
    "Jeffrey Shallit",
    "Ingrid Vukusic"
  ],
  "abstract": "Following a recent paper of Anselmo et al., we consider $m \\times n$ rectangular matrices formed from the Fibonacci word, and we show that their balance properties can be solved with a finite automaton. We also generalize the result to every Sturmian characteristic word corresponding to a quadratic irrational.",
  "subjects": [
    "math.NT",
    "cs.DM",
    "cs.FL",
    "math.CO"
  ],
  "published_date": "2025-09-30T09:28:34",
  "latex_content": "\\documentclass[12pt,reqno]{article}\n\n\\usepackage[usenames]{color}\n\\usepackage{amssymb}\n\\usepackage{amsmath}\n\\usepackage{amsthm}\n\\usepackage{amsfonts}\n\\usepackage{amscd}\n\\usepackage{graphicx}\n\n\\usepackage[colorlinks=true,\nlinkcolor=webgreen,\nfilecolor=webbrown,\ncitecolor=webgreen]{hyperref}\n\n\\definecolor{webgreen}{rgb}{0,.5,0}\n\\definecolor{webbrown}{rgb}{.6,0,0}\n\n\\usepackage{color}\n\\usepackage{fullpage}\n\\usepackage{float}\n\n\\usepackage{graphics}\n\\usepackage{latexsym}\n\\usepackage{epsf}\n\\usepackage{breakurl}\n\n\\setlength{\\textwidth}{6.5in}\n\\setlength{\\oddsidemargin}{.1in}\n\\setlength{\\evensidemargin}{.1in}\n\\setlength{\\topmargin}{-.1in}\n\\setlength{\\textheight}{8.4in}\n\n\\newcommand{\\seqnum}[1]{\\href{https://oeis.org/#1}{\\rm \\underline{#1}}}\n\n\\usepackage{mathtools}\n\\usepackage{bbm}\n\\usepackage{enumerate} \n\n\n\\DeclarePairedDelimiter\\ceil{\\lceil}{\\rceil}\n\\DeclarePairedDelimiter\\floor{\\lfloor}{\\rfloor}\n\\DeclarePairedDelimiter\\abs{\\lvert}{\\rvert}\n\n\n\\begin{document}\n\n\\title{Balanced Fibonacci word rectangles, and beyond}\n\n\\author{Jeffrey Shallit\\footnote{Research supported by NSERC grant 2024-03725.}\\\\\nSchool of Computer Science\\\\\nUniversity of Waterloo\\\\\nWaterloo, ON N2L 3G1 \\\\\nCanada\\\\\n\\href{mailto:shallit@uwaterloo.ca}{\\tt shallit@uwaterloo.ca} \\and Ingrid Vukusic\\footnote{Research funded by the Austrian Science Fund (FWF) grant J 4850-N.}\\\\\nDepartment of Mathematics\\\\\nUniversity of York\\\\\nYork, North Yorkshire YO10 5GH\\\\\nUnited Kingdom\\\\\n\\href{mailto:ingrid.vukusic@york.ac.uk}{\\tt ingrid.vukusic@york.ac.uk}.}\n\n\\maketitle\n\n\\theoremstyle{plain}\n\\newtheorem{theorem}{Theorem}\n\\newtheorem{corollary}[theorem]{Corollary}\n\\newtheorem{lemma}[theorem]{Lemma}\n\\newtheorem{proposition}[theorem]{Proposition}\n\n\\theoremstyle{definition}\n\\newtheorem{definition}[theorem]{Definition}\n\\newtheorem{example}[theorem]{Example}\n\\newtheorem{conjecture}[theorem]{Conjecture}\n\n\\theoremstyle{remark}\n\\newtheorem{remark}[theorem]{Remark}\n\n\n\\begin{abstract}\nFollowing a recent paper of Anselmo et al.,\nwe consider $m \\times n$ rectangular matrices formed from the Fibonacci word, and\nwe show that their balance properties can be solved with a finite automaton.\nWe also generalize the result to every Sturmian characteristic word corresponding\nto a quadratic irrational.\n\\end{abstract}\n\n\\section{Introduction}\n\nLet $(a_i)_{i \\geq 0}$ be an infinite sequence over $\\{0,1\\}$.\nWe can define an infinite matrix ${\\cal A} =(a_{k,\\ell})_{k,\\ell\\geq 0}$ by $a_{k,\\ell} = a_{k+\\ell}$.\nThen we can view the $m \\times n$ submatrices of $\\cal A$ as matrices where the successive rows form shifted length-$n$ ``windows'' of $(a_i)_{i \\geq 0}$, and\nthe entry in the upper left corner has index sum $i$:\n\\[\n    A(i,m,n)\n    := \\begin{pmatrix}\n        a_i & a_{i+1} & \\dots & a_{i+n-1} \\\\\n        a_{i+1} & a_{i+2} & \\dots & a_{i+n} \\\\\n        \\vdots & \\vdots &     & \\vdots \\\\\n        a_{i+m-1} & a_{i+m} & \\dots & a_{i+m+n-2} \\\\\n    \\end{pmatrix}.\n\\]\nThese are sometimes called Hankel matrices in the literature \\cite{Markovsky:2019}.\n\nThe sum over all entries in the matrix $A(i,m,n)$ equals\n\\begin{equation}\n    T(i,m,n)\n    := \\sum_{k = 0}^{m-1} \\sum_{\\ell = 0}^{n-1} a_{i+k+\\ell}.\n\\label{sum}\n\\end{equation}\nIt is clear that $A(i,m,n) = A(i,n,m)$ for all $i,m,n$.\n\nThe {\\it balance problem\\/} for $(a_i)_{i \\geq 0}$ is the following:  for which pairs\nof natural numbers $(m,n)$ are there at most two distinct values among all the $(T(i,m,n))_{i \\geq 0}$?  If this is the case, we say that the $(m,n)$-submatrices of $A$ are {\\it balanced with respect to each other\\/} or just that $(m,n)$ is {\\it balanced}.\nThis is a generalization of a more familiar notion of balance for\nbinary words, one that has been\nwell-studied \\cite{Vuillon:2003}.\n\n The famous infinite Fibonacci word ${\\bf f} = f_0 f_1 f_2\\cdots = 01001010\\cdots$ has been the subject of numerous papers \\cite{Berstel:1986b}.  It can be defined via the formula\n\\[\n    f_{n-1} = \\floor{(n+1)\\gamma} - \\floor{n \\gamma} \\in \\{0,1\\},\n\\]\nfor $n \\geq 1$,\nwhere $\\gamma = (3- \\sqrt{5})/2$.  \n\n\nRecently Anselmo et al.~\\cite{Anselmo} showed the following (their Theorem 18):\nfor $m,n \\geq 2$, if $\\max(m,n)$ is a Fibonacci number, then the $m \\times n$ blocks of ${\\cal A}_{\\gamma}$ are balanced.  Also see \\cite{Berthe}. However, there are still other $(m,n)$ pairs with the balance property, such as $(4,3)$.  This raises the natural question, which $(m,n)$ pairs are balanced for the Fibonacci word?\n\nIn this note we prove a theorem (Corollary~\\ref{fibb}) characterizing exactly those pairs $(m,n)$ that are balanced.  Our characterization is in terms of finite automata.\nThe particular result of Anselmo et al.\\ then follows as a special case.  More generally, we show how the same sort of characterization can be obtained for the matrices formed from any Sturmian word corresponding to a quadratic irrational $\\alpha$, and we show how to implement this in the free software {\\tt Walnut}.\n\n\\section{Sturmian words}\nLet $\\alpha \\in (0,1)$ be an irrational number, and define\n$$a_i = \\lfloor (i+1) \\alpha \\rfloor - \\lfloor i \\alpha \\rfloor$$\nfor $i \\geq 1$.  The infinite word\n$(a_i)_{i \\geq 1}$ is sometimes called a Sturmian characteristic word \\cite{BrownT:1993,Berstel&Seebold:2002}.  Although by convention Sturmian words are indexed starting at $1$, we can define $a_0 = 0$ without creating any new blocks that do not already appear in $\\bf f$,\nby a well-known result \\cite[2.1.18]{Berstel&Seebold:2002}.\n\nWe now define the infinite matrix ${\\cal A}_{\\alpha}$ from the terms of $(a_i)_{i \\geq 1}$; we call $A_{\\alpha}$ a Sturmian matrix.\nBy telescoping cancellation we see that\n$$\\sum_{j \\leq i \\leq k} a_i =\n\\lfloor (k+1) \\alpha \\rfloor -\n\\lfloor j \\alpha \\rfloor .$$\nHence, from the definition\n\\eqref{sum}, we get\n\\begin{align}\n    T(i+1,m,n) - T(i,m,n) \n    &= (a_{i+n} + \\dots + a_{i+m+n-1})\n        - (a_{i} + \\dots + a_{i+m-1})\\nonumber\\\\\n    &= (\\floor{(i+m+n)\\alpha} - \\floor{(i+n)\\alpha})\n        - (\\floor{(i+m)\\alpha} - \\floor{i \\alpha}).\n        \\label{fund}\n\\end{align}\nNote that for all $x,y\\geq 0$ we have $\\floor{x+y} = \\floor{x} + \\floor{y} + \\delta$ with $\\delta \\in \\{0,1\\}$.\nTherefore,\n$\\floor{(i+m+n)\\alpha} - \\floor{(i+n)\\alpha} = \\floor{m \\alpha} + \\delta_1$\nand $\\floor{(i+m)\\alpha} - \\floor{i \\alpha} = \\floor{m \\alpha} + \\delta_2$, with $\\delta_1, \\delta_2 \\in \\{0,1\\}$.\nThus,\n\\begin{equation}\n    T(i+1,m,n) - T(i,m,n)\n    = \\delta_1 - \\delta_2\n    \\in \\{-1,0,1\\}.\n\\label{bnd2}\n\\end{equation}\n\n\nDefine $\\Delta(i,m,n) := T(i+1,m,n)-T(i,m,n)$.\nThe argument above then gives the following criterion for $A(i,m,n)$ to be balanced.\n\\begin{lemma}\nIf $(a_i)_{i \\geq 0}$ is a Sturmian word corresponding to the irrational number $\\alpha$, then in the matrix \n${\\cal A}_\\alpha = (a_{i,j})_{i,j\\geq 0}$\nthe $m \\times n$ blocks are balanced\nif and only if the sequence\n$\\Delta(i,m,n)$\nhas no blocks of the form\n$1,0,0,\\ldots, 0,1$ or\n$-1,0,0,\\ldots,0, -1$.\n\\label{lemma1}\n\\end{lemma}\n\n\\begin{proof}\nThe only thing left to show is that \n$(\\Delta(i,m,n))_{i \\geq 0}$ has a block of the form $1,0,0,\\ldots, 0,1$ or\n$-1,0,0,\\ldots,0, -1$ if and only if \n$(m,n)$ is not balanced.\n\nSuppose it does have a block of the form $a,0,0,\\ldots,0,a$ for $a \\in \\{ -1, 1\\}$; say there are indices\n$i < j$ such that\n$\\Delta(i,m,n) = a$,\n$\\Delta(j,m,n) = a$ and\n$\\Delta(k,m,n) = 0$ for $i<k<j$.\nThen by telescoping cancellation\nwe have $T(j+1,m,n)= T(i,m,n) + 2a$, proving that $(m,n)$ is not balanced.\n\nNow suppose $(m,n)$ is not balanced, meaning that there exist $i< j$\nsuch that $|T(i,m,n) - T(j+1,m,n)| \\geq 2$.  Without loss of generality we may assume that $j-i$ is as small as possible.\nSince from Eq.~\\eqref{bnd2} we know that $\\Delta(i,m,n) \\in \\{-1,0,1\\}$, it follows that we must have $\\Delta(j) = a$,\n$\\Delta(i) = a$, and\n$\\Delta(k) = 0$ for $i < k < j$ and\n$a \\in \\{-1,1\\}$.\n\\end{proof}\n\n\\section{Finite automata}\n\nNow suppose $\\alpha \\in (0,1)$ is a quadratic irrational.  Then, as shown in \n\\cite{Schaeffer&Shallit&Zorcic:2024},\nthere is an algorithm to find a finite automaton $M$\nthat takes $n$ and $x$ in parallel as inputs, represented in a certain numeration system, and\naccepts if and only if $x = \\lfloor n \\alpha \\rfloor$.  The numeration system required is the so-called Ostrowski $\\alpha$-numeration system, as discussed, for example, in\n\\cite[\\S 3.9]{Allouche&Shallit:2003}.\n\nFurthermore, we also know that we can algorithmically translate a first-order logical formula $\\cal F$ involving addition, subtraction, comparisons, and other automata, into an automaton accepting the values of the free variables making $\\cal F$ true \\cite{Bruyere&Hansel&Michaux&Villemaire:1994}.\n\nOne strategy that initially seems plausible is to construct an automaton that takes\n$m,n,z$ in parallel as input, and accepts if $z$ is the number of distinct values of $T(i,m,n)$ occurring over all $i$.\nIf we had that, we could then accept those $(m,n)$ pairs corresponding to $z \\leq 2$.  However, this is not possible; we show in Section~\\ref{diverse} that\nthe number of distinct values taken by $T(i,m,n)$ for\n$m = n = F_{3j}/2$ is $\\Theta(j)$, where\n$F_t$ is the $t$'th Fibonacci number. This is impossible for an automaton that computes a function $z$ from inputs $m,n$ and accepts all three in parallel \\cite{Shallit:2021}.\n\nInstead we can use the balance criterion stated in Lemma~\\ref{lemma1}. This criterion is clearly expressible in first-order logic, since $x = \\lfloor n \\alpha \\rfloor$ is expressible.  We can then translate this first-order statement into an appropriate automaton that takes $m$ and $n$ as input (in the Ostrowski $\\alpha$-numeration system) and accepts if and only if the $m \\times n$ blocks of the matrix $A$ are balanced.\nWe therefore get our main result.\n\\begin{theorem}\nThere is an algorithm that, given a quadratic irrational\n$\\alpha$ with $0 < \\alpha < 1$, constructs a finite automaton that takes as input pairs $(m,n)$, represented in the Ostrowski $\\alpha$-numeration system, and accepts if and only if the $m \\times n$ blocks of the Sturmian matrix ${\\cal A}_{\\alpha}$  are balanced.\n\\label{main}\n\\end{theorem}\n\nLet us now carry out this construction in {\\tt Walnut} for the Fibonacci word, where\n$\\alpha = (3-\\sqrt{5})/2$.  We use the Zeckendorf numeration system \\cite{Lekkerkerker:1952,Zeckendorf:1972}, which represents integers as a sum of distinct Fibonacci numbers $F_j$.  A representation of $n$ is written \ncompactly as a binary\nword $e_i \\cdots e_2$, where\n$n = \\sum_{2 \\leq j \\leq i} e_j F_j$.\n\nTo implement the criterion in Lemma~\\ref{lemma1}, we need to compute the difference\n$T(i+1,m,n)-T(i,m,n) \\in \\{ -1,0, 1\\}$.\nUnfortunately we cannot write $-1$ in the ordinary Zeckendorf numeration system in {\\tt Walnut}, since it only deals with natural numbers.\\footnote{Actually, the negaFibonacci system is implemented in {\\tt Walnut}, so we could have used that.  But we stick with the Zeckendorf representation system because it is more familiar.}\nTo get around this problem, we work with the quantity\n$$T(i+1,m,n)-T(i,m,n)+1 \\in \\{0,1,2 \\}$$\ninstead.\n\nThe following {\\tt Walnut} code implements the criterion of Lemma~\\ref{lemma1}.\\footnote{For an introduction to {\\tt Walnut}, see the Appendix.}  For more about {\\tt Walnut}, see\n\\cite{Mousavi:2016,Shallit:2023}.\n\\begin{verbatim}\nreg shift {0,1} {0,1} \"([0,0]|[0,1][1,1]*[1,0])*\":\n# accepts x,y such that y is the left shift of the bits of x\ndef phin \"?msd_fib (n=0 & y=0) | Ez $shift(n-1,z) & y=z+1\":\n# (n,y) is accepted iff floor(n*phi) = y, where phi = (1+sqrt(5))/2\ndef alpha \"?msd_fib (n=0&z=0) | (n>0 & Ex $phin(n,x) & z+1+x=2*n)\":\n# z = floor (gamma*n), where gamma = (3-sqrt(5))/2\ndef diff \"?msd_fib Ea,b,c,d $alpha(i,a) & $alpha(i+m,b) & $alpha(i+n,c) \n   & $alpha(i+m+n,d) & z+b+c=a+d+1\":\n# z = Delta(i,m,n) + 1 = T(i+1,m,n)-T(i,m,n)+1\ndef bal \"?msd_fib ~Ei,j i>0 & i<j & (($diff(i,m,n,2) \n   & (Ak (i<k & k<j) => $diff(k,m,n,1)) & $diff(j,m,n,2)) |\n   ($diff(i,m,n,0) & (Ak (i<k & k<j) => $diff(k,m,n,1)) & $diff(j,m,n,0)))\":\n# implements the balance criterion of Lemma 1\n\\end{verbatim}\nThis gives a $15$-state automaton {\\tt bal} that accepts exactly those $(m,n)$ pairs, in the Zeckendorf numeration system, that are balanced.  An input consisting of a word made of pairs  is accepted  by the automaton \nif there is a path from state $0$ labeled with \nthose pairs. See Figure~\\ref{fig1}.\n\\begin{figure}[htb]\n\\includegraphics[width=6.5in]{bal.pdf}\n\\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word.}\n\\label{fig1}\n\\end{figure}\n\nWe have therefore shown\n\\begin{corollary}\nThe automaton in Figure~\\ref{fig1} solves the balanced property for Fibonacci word rectangles.\n\\label{fibb}\n\\end{corollary}\n\n\nAs an example, consider using the automaton to determine whether the $4 \\times 18$ blocks are balanced.  We represent $4$\nby $101$ in the Zeckendorf system and $18$ by\n$101000$.  Padding the shorter with $0$ and entering the inputs in parallel\n$[0,1][0,0][0,1][1,0][0,0][1,0]$ into the automaton in Figure~\\ref{fig1}, we start at state $0$ and successively visit states $2, 6, 2, 7, 14$, and $7$ and accept.  So $(m,n)$ is balanced.\n\nAs a special case, we can now recover the theorem of Anselmo et al., as follows:\n\\begin{corollary}\nIf $\\max(m,n)$ is a Fibonacci number then the $m \\times n$ matrices of ${\\cal A}_{\\gamma}$\nare balanced.\n\\end{corollary}\n\\begin{proof}\nWe use {\\tt Walnut}:\n\\begin{verbatim}\nreg isfib msd_fib \"0*10*\":\n# is input a Fibonacci number\ndef max \"?msd_fib (z=m|z=n) & z>=m & z>=n\":\n# is z = max(x,y)\neval anselmo \"?msd_fib Am,n,z ($max(m,n,z) & $isfib(z)) => $bal(m,n)\":\n# translation of their theorem\n\\end{verbatim}\nAnd {\\tt Walnut} returns {\\tt TRUE}.\n\\end{proof}\n\nThe {\\tt bal} automaton allows us to prove a wide variety of results about the $(m,n)$-balanced pairs for ${\\cal A}_{\\gamma}$.  Here is one example.\n\n\\begin{proposition}\nLet $n \\geq 2$.\n\\begin{itemize}\n  \\item[(a)] \n    $(i,j)$ is balanced if and only if\n    $(i',j)$ is balanced, for\n    $F_{n+1} < i,i' < F_{n+2}$\n    and $j \\geq F_{n-1}$.\n\n    \\item[(b)]\n    $(F_{n+1} + i,j)$\n    is balanced if and only if\n    $(F_{n+2} -i, j)$\n    is balanced, for\n    $1 \\leq i < F_n$\n    and $j \\geq 1$.\n\\end{itemize}\n\\end{proposition}\n\n\\begin{proof}\nWe use {\\tt Walnut}.\nFor (a) we use the commands\n\\begin{verbatim}\nreg adjfib msd_fib msd_fib \"[0,0]*[0,1][1,0][0,0]*\":\n# accepts (F_n, F_{n+1}) for n>=2\neval claima \"?msd_fib Au,v,x,i,ip,j ($adjfib(u,v) & x=u+v & i>v & ip>v \n   & i<x &ip<x & j>=v-u) => ($bal(i,j) <=> $bal(ip,j))\":\n# u = F_{n}, v = F_{n+1}, x = F_{n+2}\n\\end{verbatim}\nAnd {\\tt Walnut} returns {\\tt TRUE}.\n\nFor (b) we use the commands\n\\begin{verbatim}\neval claimb \"?msd_fib Au,v,x,i,j ($adjfib(u,v) & x=u+v & i>=1 & i<u & j>=1) => \n   ($bal(v+i,j) <=> $bal(x-i,j))\":\n# u = F_n, v = F_{n+1}, x = F_{n+2}\n\\end{verbatim}\nAnd {\\tt Walnut} returns {\\tt TRUE}.\n\\end{proof}\n\nWe can also obtain a result about the density of balanced pairs $(m,n)$.\n\\begin{proposition}\nSuppose $F_i < m \\leq F_{i+1}$.  Then for all $n\\geq 1$ there exists $j$,\n$1 \\leq j \\leq F_{i+1}$, \nsuch that $(m,n+j)$\nis balanced.   Furthermore the upper bound $F_{i+1}$ is optimal for each $m$.\n\\end{proposition}\n\n\\begin{proof}\nWe use {\\tt Walnut}.\n\\begin{verbatim}\neval density \"?msd_fib Am,x,y,n ($adjfib(x,y) & x<m & m<=y) \n   => Ej j>=1 & j<=y & $bal(m,n+j)\":\n# x = F_i, y = F_{i+1}\n\\end{verbatim}\nwhich proves the first statement.  To prove the second, we show that for each $m$\nthere exists $n$ such that the least $j\\geq 1$\nwith $(m,n+j)$ balanced is $\\geq F_{i+1}$.\n\\begin{verbatim}\neval density2 \"?msd_fib Am,x,y ($adjfib(x,y) & x<m & m<=y) \n   => (En Aj (j>=1 & j<y) => ~$bal(m,n+j))\":\n\\end{verbatim}\nAnd {\\tt Walnut} returns {\\tt TRUE}.\n\\end{proof}\nThese results essentially say that the density of $n$\nfor which $(m,n)$ is balanced is lower bounded by (approximately)\n$1 \\over {\\varphi m}$.\n\n\\section{Another version of the criterion for balance}\n\nWe can obtain a more ``human readable'' version of the criterion for the $m \\times n$ submatrices of $A_{\\gamma}$ to be balanced, as follows:  \n\n\\begin{theorem}\nAssume $m \\leq n$ and let the Zeckendorf expansion of $m$ (resp., $n$) be $F_{a_1} + \\dots + F_{a_k}$ (resp., $ F_{b_1} + \\dots + F_{b_\\ell}$) for $a_1 > \\cdots >a_k$ and $b_1 > \\cdots > b_\\ell$.\nThen $(m,n)$ is accepted by {\\tt bal} if and only if at least one of the following cases holds:\n\\begin{itemize}\n    \\item[(a)] $m = 0$ or $m = 1$; \n\n    \\item[(b)] $m = F_{a_1}$ and $a_1 \\notin \\{b_1, \\ldots, b_\\ell\\}$ and for $b_j > a_1 > b_{j+1}$ the indices $a_1$ and $b_j$ have the same parity; \n    \n    \\item[(c)] $m = F_{a_1}$ and $a_1 \\in \\{b_1, \\ldots, b_\\ell\\}$; \n    \n    \\item[(d)] $a_1 =  b_\\ell$, (i.e., the largest Fibonacci number in the representation of $m$ is the smallest Fibonacci number in the representation of $n$)\n\tand $b_\\ell$ and $b_{\\ell-1}$ have distinct parities; \n     \n    \\item[(e)] $a_1 < b_\\ell$ (i.e., the largest Fibonacci number in the representation of $m$ is smaller than the smallest Fibonacci number in the representation of $n$). \n\\end{itemize}\n\\end{theorem}\n\n\\begin{proof}\nTo find the characterization we traced the paths in the automaton in Figure~\\ref{fig:colored}, which is the automaton {\\tt bal} from Figure~\\ref{fig1} restricted to $m \\leq n$.\n\n\n\n\\begin{figure}[htb]\n\\includegraphics[width=6.5in]{bala_colored.pdf}\n\\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word with $m \\leq n$.}\n\\label{fig:colored}\n\\end{figure}\n\nThe {\\tt Walnut} code below verifies the characterization. \nNote that for simplicity, the regular expressions are not necessarily valid Zeckendorf representations. We can do this because eventually in {\\tt test} only the valid Zeckendorf representations are considered by\n{\\tt Walnut}.\nThe mentioned colors are meant to help the interested reader find the paths in Figure~\\ref{fig:colored} corresponding to each regular expression. The ``upper part'' refers to the states $4,8$; the ``lower part'' to $2,5$ (and the state $10$ belongs to both).\n\n\\begin{verbatim}\nreg case_a msd_fib msd_fib \"([0,0]|[0,1])*|([0,0]|[0,1])*([1,0]|[1,1])\":\n\nreg case_b msd_fib msd_fib \n\"([0,0]|[0,1])*[0,1][0,0]([0,0][0,0])*[1,0]([0,0]|[0,1])*\":\n# lower part of red\n\nreg case_c msd_fib msd_fib \"([0,0]|[0,1])*[1,1]([0,0]|[0,1])*\":\n# dark blue, light blue, and the lower part of yellow\n\nreg case_d msd_fib msd_fib \n\"([0,0]|[0,1])*[0,1]([0,0][0,0])*[1,1]([0,0]|[1,0])*\":\n# upper part of yellow\n\nreg case_e msd_fib msd_fib \"([0,0]|[0,1])*([0,0]|[1,0])*\":\n# dark green, light green, and upper part of red\n\neval test \"?msd_fib Am,n (m<=n) => \n   (($case_a(m,n)|$case_b(m,n)|$case_c(m,n)|$case_d(m,n)|$case_e(m,n)) \n   <=> $bal(m,n))\":\n\\end{verbatim}\nAnd {\\tt Walnut} returns {\\tt TRUE}.\n\\end{proof}\n\n\n\n\\section{Diverse rectangles}\n\\label{diverse}\n\n\\begin{theorem}\nConsider the word rectangles formed from the Fibonacci word $\\bf f$ with the indexing $f_0 f_1 f_2 \\cdots = 0100$.\nThe number of distinct values\nof $T(i,m,n)$, taken over all $i$,\nfor $m = n = F_{3k}/2$, is at least\n$k+1$.\n\\label{bnd}\n\\end{theorem}\n\n\\begin{proof}\nWe claim that\n\\begin{align}\nT (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2)  - T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2) &= 2n \\label{t1} \\\\\nT((F_{6n+5}-1)/4, F_{6n+3}/2, F_{6n+3}/2) - T((F_{6n+2}-1)/4, F_{6n+3}/2, F_{6n+3}/2) &= 2n+1. \\label{t2}\n\\end{align}\n\nTo prove these claims we use {\\tt Walnut} and its capabilities of producing linear representations.   A linear representation for a function $f(n)$ is a triple $(v,\\zeta, w)$ where $v$ is a row vector, $w$ is a column vector, and $\\zeta$ is a matrix-valued morphism, such that $f(n) = v \\zeta(x) w$ for all representations of $x$ that evaluate to $n$.  In this case, of course, $x$ is a Zeckendorf representation. \n\nLet us verify Eq.~\\eqref{t1}.  We define three functions, as follows:\n\\begin{itemize}\n    \\item  $f(F_{6n}) = T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$,\n    and $f(t)= 0$ for all other $t$.\n\n    \\item  $g(F_{6n}) = T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$,\n    and $g(t)= 0$ for all other $t$.\n\n    \\item $h(F_{6n}) = 6n$\n    for $n \\geq 1$, and $h(t)= 0$ for all other $t$.\n\\end{itemize}\nThen Eq.~\\eqref{t1} is equivalent to the claim that $3f(t)-3g(t)-h(t) = 0$ for all $t$.  Our strategy is to construct linear representations for each of the functions $f(t)$, $g(t)$, and $h(t)$, using {\\tt Walnut}, and then combine them to find a linear representation for\n$3f(t)-3g(t)-h(t)$.\n\n\nConsider the following code:\n\\begin{verbatim}\nreg fib6 msd_fib \"0*1(000000)*0000\":\ndef cnt6a t \"?msd_fib $fib6(t) & Ex,y $adjfib(t,x) & $adjfib(x,y) & \n   F[(y-1)/4+j+k]=@1 & j<t/2 & k<t/2\":\n# t = F_{6n}, x = F_{6n+1}, y = F_{6n+2}\ndef cnt6b t \"?msd_fib $fib6(t) & Eu $adjfib(u,t) & \n   F[(u-1)/4+j+k]=@1 & j<t/2 & k<t/2\":\n# t = F_{6n}, u = F_{6n-1}\ndef numfib \"?msd_fib Ey $adjfib(x,y) & i<=y & $isfib(i)\":\ndef numfib6 t \"?msd_fib $fib6(t) & $numfib(i,t)\":\n\\end{verbatim}\nHere\n\\begin{itemize}\n\\item {\\tt fib6} accepts the Zeckendorf expansion of $F_{6n}$ for $n \\geq 1$.\n\\item {\\tt cnt6a} generates a linear representation of rank $123$ for the function $f(t)$.\n\\item {\\tt cnt6b}\ngenerates a linear representation of rank $121$ for the function $g(t)$.\n\\item {\\tt numfib}$(i,x)$ accepts if and only\nif $x = F_n$ for some $n \\geq 2$ and $i=n$.\n\\item {\\tt numfib6} creates a linear representation of rank $14$ for the function $h(t)$.\n\\end{itemize}\nIn {\\tt Walnut} these linear representations are provided as {\\tt Maple} files.\n\nFrom these linear representations we can easily compute, through standard matrix methods, a linear representation of rank $258 = 123 + 121 + 14$ for\n$3g(t) - 3f(t) - h(t)$. There is an algorithm to decide\nif a given linear representation represents the $0$ function \\cite{Berstel&Reutenauer:2011}.  We use {\\tt Walnut} to create the representations and then a {\\tt Maple} program to check if $3f(t)-3g(t)-h(t)$ is identically $0$. \nThis proves Eq.~\\eqref{t1}, and Eq.~\\eqref{t2} follows in a similar manner.\n\\end{proof}\n\n\\begin{corollary}\nThe number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is\n$\\Theta(n)$.\n\\end{corollary}\n\\begin{proof}\nFrom a result of Berth\\'e and Tijdeman \n\\cite{Berthe} we know that the number of distinct values of\n$T(i,x,x)$ is $O(\\log x)$.  From Theorem~\\ref{bnd} we know the number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Omega(n)$.  Combining these gives the result.\n\\end{proof}\n\n\\section*{Acknowledgment}\n\nWe acknowledge with thanks discussions with Narad Rampersad.\n\n\\begin{thebibliography}{10}\n\\expandafter\\ifx\\csname url\\endcsname\\relax\n  \\def\\url#1{\\texttt{#1}}\\fi\n\\expandafter\\ifx\\csname doi\\endcsname\\relax\n  \\def\\doi#1{\\burlalt{doi:#1}{http://dx.doi.org/#1}}\\fi\n\\expandafter\\ifx\\csname urlprefix\\endcsname\\relax\\def\\urlprefix{URL: }\\fi\n\\expandafter\\ifx\\csname href\\endcsname\\relax\n  \\def\\href#1#2{#2}\\fi\n\\expandafter\\ifx\\csname burlalt\\endcsname\\relax\n  \\def\\burlalt#1#2{\\href{#2}{#1}}\\fi\n\n\\bibitem{Allouche&Shallit:2003}\nJ.-P. Allouche and J.~Shallit.\n\\newblock {\\em Automatic Sequences: Theory, Applications, Generalizations}.\n\\newblock Cambridge University Press, 2003.\n\n\\bibitem{Anselmo}\nM.~Anselmo, D.~Giammarresi, M.~Madonia, and C.~Selmi.\n\\newblock Fibonacci pictures on a binary alphabet.\n\\newblock In A.~Malcher and L.~Prigioniero, editors, {\\em DCFS 2025}, volume\n  15759 of {\\em Lecture Notes in Computer Science}, pages 1--16.\n  Springer-Verlag, 2025.\n\n\\bibitem{Berstel:1986b}\nJ.~Berstel.\n\\newblock Fibonacci words---a survey.\n\\newblock In G.~Rozenberg and A.~Salomaa, editors, {\\em The Book of L}, pages\n  13--27. Springer-Verlag, 1986.\n\n\\bibitem{Berstel&Reutenauer:2011}\nJ.~Berstel and C.~Reutenauer.\n\\newblock {\\em Noncommutative Rational Series With Applications}, volume 137 of\n  {\\em Encyclopedia of Mathematics and Its Applications}.\n\\newblock Cambridge Univ. Press, 2011.\n\n\\bibitem{Berstel&Seebold:2002}\nJ.~Berstel and P.~{S\\'e\\'ebold}.\n\\newblock Sturmian words.\n\\newblock In M.~Lothaire, editor, {\\em Algebraic Combinatorics on Words}, pages\n  45--110. Cambridge University Press, 2002.\n\n\\bibitem{Berthe}\nV.~Berth{\\'e} and R.~Tijdeman.\n\\newblock Balance properties of multi-dimensional words.\n\\newblock {\\em Theoret. Comput. Sci.}, 273:197--224, 2002.\n\n\\bibitem{BrownT:1993}\nT.~C. Brown.\n\\newblock Descriptions of the characteristic sequence of an irrational.\n\\newblock {\\em Canad. Math. Bull.}, 36:15--21, 1993.\n\n\\bibitem{Bruyere&Hansel&Michaux&Villemaire:1994}\nV.~{Bruy\\`ere}, G.~Hansel, C.~Michaux, and R.~Villemaire.\n\\newblock Logic and $p$-recognizable sets of integers.\n\\newblock {\\em Bull. Belgian Math. Soc.}, 1:191--238, 1994.\n\\newblock Corrigendum, {\\it Bull.\\ Belgian\\ Math.\\ Soc.} {\\bf 1} (1994), 577.\n\n\\bibitem{Lekkerkerker:1952}\nC.~G. Lekkerkerker.\n\\newblock Voorstelling van natuurlijke getallen door een som van getallen van\n  {Fibonacci}.\n\\newblock {\\em Simon Stevin}, 29:190--195, 1952.\n\n\\bibitem{Markovsky:2019}\nI.~Markovsky.\n\\newblock {\\em Low-Rank Approximation: Algorithms, Implementation,\n  Applications}.\n\\newblock Springer-Verlag, 2nd edition, 2019.\n\n\\bibitem{Mousavi:2016}\nH.~Mousavi.\n\\newblock Automatic theorem proving in \\texttt{{{Walnut}}}.\n\\newblock ArXiv preprint arXiv:1603.06017 [cs.FL], 2016.\n\\newblock \\urlprefix\\url{http://arxiv.org/abs/1603.06017}.\n\n\\bibitem{Schaeffer&Shallit&Zorcic:2024}\nL.~Schaeffer, J.~Shallit, and S.~Zorcic.\n\\newblock Beatty sequences for a quadratic irrational: decidability and\n  applications.\n\\newblock Arxiv preprint arXiv:2402.08331 [math.NT]. Available at\n  \\url{https://arxiv.org/abs/2402.08331}, 2024.\n\n\\bibitem{Shallit:2021}\nJ.~Shallit.\n\\newblock Synchronized sequences.\n\\newblock In T.~Lecroq and S.~Puzynina, editors, {\\em WORDS 2021}, volume 12847\n  of {\\em Lecture Notes in Computer Science}, pages 1--19. Springer-Verlag,\n  2021.\n\\newblock \\doi{10.1007/978-3-030-85088-3_1}.\n\n\\bibitem{Shallit:2023}\nJ.~Shallit.\n\\newblock {\\em The Logical Approach To Automatic Sequences: Exploring\n  Combinatorics on Words with {\\tt Walnut}}, volume 482 of {\\em London\n  Mathematical Society Lecture Note Series}.\n\\newblock Cambridge University Press, 2023.\n\n\\bibitem{Vuillon:2003}\nL.~Vuillon.\n\\newblock Balanced words.\n\\newblock {\\em Bull. Belgian Math. Soc.}, 10(5):787--805, 12 2003.\n\\newblock \\doi{10.36045/bbms/1074791332}.\n\n\\bibitem{Zeckendorf:1972}\nE.~Zeckendorf.\n\\newblock {Repr\\'esentation} des nombres naturels par une somme de nombres de\n  {Fibonacci} ou de nombres de {Lucas}.\n\\newblock {\\em Bull. Soc. Roy. {Li\\`ege}}, 41:179--182, 1972.\n\n\\end{thebibliography}\n\n\\appendix\n\\section{{\\tt Walnut} commands}\n\nThe three principal {\\tt Walnut} commands used in this paper are\n\\begin{itemize}\n    \\item {\\tt reg}:  defines a regular expression;\n    \\item {\\tt def}: defines an automaton for later use;\n    \\item {\\tt def}: evaluates a first-order logical statement with no free variables as {\\tt TRUE} or {\\tt FALSE}.\n\\end{itemize}\n\nThe jargon {\\tt ?msd\\_fib} at the beginning of a command tells {\\tt Walnut} that numbers are represented in the Zeckendorf numeration system.\n\nLogical AND $(\\wedge)$ is represented by {\\tt \\&}; logical OR $(\\vee)$ is represented by {\\tt |}; logical NOT $(\\neg)$ is represented by\n{\\tt \\char'176}; implication is represented by {\\tt =>}; and logical\nIFF is represented by {\\tt <=>}.\n\nThe capital letter {\\tt A} is the universal quantifier $\\forall$; the capital letter {\\tt E} is the existential quantifier $\\exists$.\n\nComments are denoted with the symbol {\\tt \\#}.\n\nWhen an automaton is defined as a function of its unbound variables, it may be reused and the order of the arguments is the alphabetical order of the variable names used when it was defined.\n\nThe capital letter {\\tt F} refers to the Fibonacci word ${\\bf f} = 01001\\cdots$, indexed starting at $0$.\n\n\n\\end{document}\n\n",
  "main_tex_file": "arxiv.tex",
  "saved_at": "2025-10-02T04:04:41.391368"
}