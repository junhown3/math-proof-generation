{
  "abstract": "Following a recent paper of Anselmo et al., we consider $m \\times n$ rectangular matrices formed from the Fibonacci word, and we show that their balance properties can be solved with a finite automaton. We also generalize the result to every Sturmian characteristic word corresponding to a quadratic irrational.",
  "introduction": "Let $(a_i)_{i \\geq 0}$ be an infinite sequence over $\\{0,1\\}$. We can define an infinite matrix ${\\cal A} =(a_{k,\\ell})_{k,\\ell\\geq 0}$ by $a_{k,\\ell} = a_{k+\\ell}$. Then we can view the $m \\times n$ submatrices of $\\cal A$ as matrices where the successive rows form shifted length-$n$ ``windows'' of $(a_i)_{i \\geq 0}$, and the entry in the upper left corner has index sum $i$: \\[ A(i,m,n) := \\begin{pmatrix} a_i & a_{i+1} & \\dots & a_{i+n-1} \\\\ a_{i+1} & a_{i+2} & \\dots & a_{i+n} \\\\ \\vdots & \\vdots & & \\vdots \\\\ a_{i+m-1} & a_{i+m} & \\dots & a_{i+m+n-2} \\\\ \\end{pmatrix}. \\] These are sometimes called Hankel matrices in the literature \\cite{Markovsky:2019}. The sum over all entries in the matrix $A(i,m,n)$ equals \\begin{equation} T(i,m,n) := \\sum_{k = 0}^{m-1} \\sum_{\\ell = 0}^{n-1} a_{i+k+\\ell}. \\label{sum} \\end{equation} It is clear that $A(i,m,n) = A(i,n,m)$ for all $i,m,n$. The {\\it balance problem\\/} for $(a_i)_{i \\geq 0}$ is the following: for which pairs of natural numbers $(m,n)$ are there at most two distinct values among all the $(T(i,m,n))_{i \\geq 0}$? If this is the case, we say that the $(m,n)$-submatrices of $A$ are {\\it balanced with respect to each other\\/} or just that $(m,n)$ is {\\it balanced}. This is a generalization of a more familiar notion of balance for binary words, one that has been well-studied \\cite{Vuillon:2003}. The famous infinite Fibonacci word ${\\bf f} = f_0 f_1 f_2\\cdots = 01001010\\cdots$ has been the subject of numerous papers \\cite{Berstel:1986b}. It can be defined via the formula \\[ f_{n-1} = \\floor{(n+1)\\gamma} - \\floor{n \\gamma} \\in \\{0,1\\}, \\] for $n \\geq 1$, where $\\gamma = (3- \\sqrt{5})/2$. Recently Anselmo et al.~\\cite{Anselmo} showed the following (their Theorem 18): for $m,n \\geq 2$, if $\\max(m,n)$ is a Fibonacci number, then the $m \\times n$ blocks of ${\\cal A}_{\\gamma}$ are balanced. Also see \\cite{Berthe}. However, there are still other $(m,n)$ pairs with the balance property, such as $(4,3)$. This raises the natural question, which $(m,n)$ pairs are balanced for the Fibonacci word? In this note we prove a theorem (Corollary~\\ref{fibb}) characterizing exactly those pairs $(m,n)$ that are balanced. Our characterization is in terms of finite automata. The particular result of Anselmo et al.\\ then follows as a special case. More generally, we show how the same sort of characterization can be obtained for the matrices formed from any Sturmian word corresponding to a quadratic irrational $\\alpha$, and we show how to implement this in the free software {\\tt Walnut}.",
  "sections": [
    {
      "content_type": "section",
      "title": "Introduction",
      "content": "Let $(a_i)_{i \\geq 0}$ be an infinite sequence over $\\{0,1\\}$. We can define an infinite matrix ${\\cal A} =(a_{k,\\ell})_{k,\\ell\\geq 0}$ by $a_{k,\\ell} = a_{k+\\ell}$. Then we can view the $m \\times n$ submatrices of $\\cal A$ as matrices where the successive rows form shifted length-$n$ ``windows'' of $(a_i)_{i \\geq 0}$, and the entry in the upper left corner has index sum $i$: \\[ A(i,m,n) := \\begin{pmatrix} a_i & a_{i+1} & \\dots & a_{i+n-1} \\\\ a_{i+1} & a_{i+2} & \\dots & a_{i+n} \\\\ \\vdots & \\vdots & & \\vdots \\\\ a_{i+m-1} & a_{i+m} & \\dots & a_{i+m+n-2} \\\\ \\end{pmatrix}. \\] These are sometimes called Hankel matrices in the literature \\cite{Markovsky:2019}. The sum over all entries in the matrix $A(i,m,n)$ equals \\begin{equation} T(i,m,n) := \\sum_{k = 0}^{m-1} \\sum_{\\ell = 0}^{n-1} a_{i+k+\\ell}. \\label{sum} \\end{equation} It is clear that $A(i,m,n) = A(i,n,m)$ for all $i,m,n$. The {\\it balance problem\\/} for $(a_i)_{i \\geq 0}$ is the following: for which pairs of natural numbers $(m,n)$ are there at most two distinct values among all the $(T(i,m,n))_{i \\geq 0}$? If this is the case, we say that the $(m,n)$-submatrices of $A$ are {\\it balanced with respect to each other\\/} or just that $(m,n)$ is {\\it balanced}. This is a generalization of a more familiar notion of balance for binary words, one that has been well-studied \\cite{Vuillon:2003}. The famous infinite Fibonacci word ${\\bf f} = f_0 f_1 f_2\\cdots = 01001010\\cdots$ has been the subject of numerous papers \\cite{Berstel:1986b}. It can be defined via the formula \\[ f_{n-1} = \\floor{(n+1)\\gamma} - \\floor{n \\gamma} \\in \\{0,1\\}, \\] for $n \\geq 1$, where $\\gamma = (3- \\sqrt{5})/2$. Recently Anselmo et al.~\\cite{Anselmo} showed the following (their Theorem 18): for $m,n \\geq 2$, if $\\max(m,n)$ is a Fibonacci number, then the $m \\times n$ blocks of ${\\cal A}_{\\gamma}$ are balanced. Also see \\cite{Berthe}. However, there are still other $(m,n)$ pairs with the balance property, such as $(4,3)$. This raises the natural question, which $(m,n)$ pairs are balanced for the Fibonacci word? In this note we prove a theorem (Corollary~\\ref{fibb}) characterizing exactly those pairs $(m,n)$ that are balanced. Our characterization is in terms of finite automata. The particular result of Anselmo et al.\\ then follows as a special case. More generally, we show how the same sort of characterization can be obtained for the matrices formed from any Sturmian word corresponding to a quadratic irrational $\\alpha$, and we show how to implement this in the free software {\\tt Walnut}.",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    },
    {
      "content_type": "section",
      "title": "Sturmian words",
      "content": "Let $\\alpha \\in (0,1)$ be an irrational number, and define $$a_i = \\lfloor (i+1) \\alpha \\rfloor - \\lfloor i \\alpha \\rfloor$$ for $i \\geq 1$. The infinite word $(a_i)_{i \\geq 1}$ is sometimes called a Sturmian characteristic word \\cite{BrownT:1993,Berstel&Seebold:2002}. Although by convention Sturmian words are indexed starting at $1$, we can define $a_0 = 0$ without creating any new blocks that do not already appear in $\\bf f$, by a well-known result \\cite[2.1.18]{Berstel&Seebold:2002}. We now define the infinite matrix ${\\cal A}_{\\alpha}$ from the terms of $(a_i)_{i \\geq 1}$; we call $A_{\\alpha}$ a Sturmian matrix. By telescoping cancellation we see that $$\\sum_{j \\leq i \\leq k} a_i = \\lfloor (k+1) \\alpha \\rfloor - \\lfloor j \\alpha \\rfloor .$$ Hence, from the definition \\eqref{sum}, we get \\begin{align} T(i+1,m,n) - T(i,m,n) &= (a_{i+n} + \\dots + a_{i+m+n-1}) - (a_{i} + \\dots + a_{i+m-1})\\nonumber\\\\ &= (\\floor{(i+m+n)\\alpha} - \\floor{(i+n)\\alpha}) - (\\floor{(i+m)\\alpha} - \\floor{i \\alpha}). \\label{fund} \\end{align} Note that for all $x,y\\geq 0$ we have $\\floor{x+y} = \\floor{x} + \\floor{y} + \\delta$ with $\\delta \\in \\{0,1\\}$. Therefore, $\\floor{(i+m+n)\\alpha} - \\floor{(i+n)\\alpha} = \\floor{m \\alpha} + \\delta_1$ and $\\floor{(i+m)\\alpha} - \\floor{i \\alpha} = \\floor{m \\alpha} + \\delta_2$, with $\\delta_1, \\delta_2 \\in \\{0,1\\}$. Thus, \\begin{equation} T(i+1,m,n) - T(i,m,n) = \\delta_1 - \\delta_2 \\in \\{-1,0,1\\}. \\label{bnd2} \\end{equation} Define $\\Delta(i,m,n) := T(i+1,m,n)-T(i,m,n)$. The argument above then gives the following criterion for $A(i,m,n)$ to be balanced. \\begin{lemma} If $(a_i)_{i \\geq 0}$ is a Sturmian word corresponding to the irrational number $\\alpha$, then in the matrix ${\\cal A}_\\alpha = (a_{i,j})_{i,j\\geq 0}$ the $m \\times n$ blocks are balanced if and only if the sequence $\\Delta(i,m,n)$ has no blocks of the form $1,0,0,\\ldots, 0,1$ or $-1,0,0,\\ldots,0, -1$. \\label{lemma1} \\end{lemma} \\begin{proof} The only thing left to show is that $(\\Delta(i,m,n))_{i \\geq 0}$ has a block of the form $1,0,0,\\ldots, 0,1$ or $-1,0,0,\\ldots,0, -1$ if and only if $(m,n)$ is not balanced. Suppose it does have a block of the form $a,0,0,\\ldots,0,a$ for $a \\in \\{ -1, 1\\}$; say there are indices $i < j$ such that $\\Delta(i,m,n) = a$, $\\Delta(j,m,n) = a$ and $\\Delta(k,m,n) = 0$ for $i<k<j$. Then by telescoping cancellation we have $T(j+1,m,n)= T(i,m,n) + 2a$, proving that $(m,n)$ is not balanced. Now suppose $(m,n)$ is not balanced, meaning that there exist $i< j$ such that $|T(i,m,n) - T(j+1,m,n)| \\geq 2$. Without loss of generality we may assume that $j-i$ is as small as possible. Since from Eq.~\\eqref{bnd2} we know that $\\Delta(i,m,n) \\in \\{-1,0,1\\}$, it follows that we must have $\\Delta(j) = a$, $\\Delta(i) = a$, and $\\Delta(k) = 0$ for $i < k < j$ and $a \\in \\{-1,1\\}$. \\end{proof}",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    },
    {
      "content_type": "section",
      "title": "Finite automata",
      "content": "Now suppose $\\alpha \\in (0,1)$ is a quadratic irrational. Then, as shown in \\cite{Schaeffer&Shallit&Zorcic:2024}, there is an algorithm to find a finite automaton $M$ that takes $n$ and $x$ in parallel as inputs, represented in a certain numeration system, and accepts if and only if $x = \\lfloor n \\alpha \\rfloor$. The numeration system required is the so-called Ostrowski $\\alpha$-numeration system, as discussed, for example, in \\cite[\\S 3.9]{Allouche&Shallit:2003}. Furthermore, we also know that we can algorithmically translate a first-order logical formula $\\cal F$ involving addition, subtraction, comparisons, and other automata, into an automaton accepting the values of the free variables making $\\cal F$ true \\cite{Bruyere&Hansel&Michaux&Villemaire:1994}. One strategy that initially seems plausible is to construct an automaton that takes $m,n,z$ in parallel as input, and accepts if $z$ is the number of distinct values of $T(i,m,n)$ occurring over all $i$. If we had that, we could then accept those $(m,n)$ pairs corresponding to $z \\leq 2$. However, this is not possible; we show in Section~\\ref{diverse} that the number of distinct values taken by $T(i,m,n)$ for $m = n = F_{3j}/2$ is $\\Theta(j)$, where $F_t$ is the $t$'th Fibonacci number. This is impossible for an automaton that computes a function $z$ from inputs $m,n$ and accepts all three in parallel \\cite{Shallit:2021}. Instead we can use the balance criterion stated in Lemma~\\ref{lemma1}. This criterion is clearly expressible in first-order logic, since $x = \\lfloor n \\alpha \\rfloor$ is expressible. We can then translate this first-order statement into an appropriate automaton that takes $m$ and $n$ as input (in the Ostrowski $\\alpha$-numeration system) and accepts if and only if the $m \\times n$ blocks of the matrix $A$ are balanced. We therefore get our main result. \\begin{theorem} There is an algorithm that, given a quadratic irrational $\\alpha$ with $0 < \\alpha < 1$, constructs a finite automaton that takes as input pairs $(m,n)$, represented in the Ostrowski $\\alpha$-numeration system, and accepts if and only if the $m \\times n$ blocks of the Sturmian matrix ${\\cal A}_{\\alpha}$ are balanced. \\label{main} \\end{theorem} Let us now carry out this construction in {\\tt Walnut} for the Fibonacci word, where $\\alpha = (3-\\sqrt{5})/2$. We use the Zeckendorf numeration system \\cite{Lekkerkerker:1952,Zeckendorf:1972}, which represents integers as a sum of distinct Fibonacci numbers $F_j$. A representation of $n$ is written compactly as a binary word $e_i \\cdots e_2$, where $n = \\sum_{2 \\leq j \\leq i} e_j F_j$. To implement the criterion in Lemma~\\ref{lemma1}, we need to compute the difference $T(i+1,m,n)-T(i,m,n) \\in \\{ -1,0, 1\\}$. Unfortunately we cannot write $-1$ in the ordinary Zeckendorf numeration system in {\\tt Walnut}, since it only deals with natural numbers.\\footnote{Actually, the negaFibonacci system is implemented in {\\tt Walnut}, so we could have used that. But we stick with the Zeckendorf representation system because it is more familiar.} To get around this problem, we work with the quantity $$T(i+1,m,n)-T(i,m,n)+1 \\in \\{0,1,2 \\}$$ instead. The following {\\tt Walnut} code implements the criterion of Lemma~\\ref{lemma1}.\\footnote{For an introduction to {\\tt Walnut}, see the Appendix.} For more about {\\tt Walnut}, see \\cite{Mousavi:2016,Shallit:2023}. \\begin{verbatim} reg shift {0,1} {0,1} \"([0,0]|[0,1][1,1]*[1,0])*\": # accepts x,y such that y is the left shift of the bits of x def phin \"?msd_fib (n=0 & y=0) | Ez $shift(n-1,z) & y=z+1\": # (n,y) is accepted iff floor(n*phi) = y, where phi = (1+sqrt(5))/2 def alpha \"?msd_fib (n=0&z=0) | (n>0 & Ex $phin(n,x) & z+1+x=2*n)\": # z = floor (gamma*n), where gamma = (3-sqrt(5))/2 def diff \"?msd_fib Ea,b,c,d $alpha(i,a) & $alpha(i+m,b) & $alpha(i+n,c) & $alpha(i+m+n,d) & z+b+c=a+d+1\": # z = Delta(i,m,n) + 1 = T(i+1,m,n)-T(i,m,n)+1 def bal \"?msd_fib ~Ei,j i>0 & i<j & (($diff(i,m,n,2) & (Ak (i<k & k<j) => $diff(k,m,n,1)) & $diff(j,m,n,2)) | ($diff(i,m,n,0) & (Ak (i<k & k<j) => $diff(k,m,n,1)) & $diff(j,m,n,0)))\": # implements the balance criterion of Lemma 1 \\end{verbatim} This gives a $15$-state automaton {\\tt bal} that accepts exactly those $(m,n)$ pairs, in the Zeckendorf numeration system, that are balanced. An input consisting of a word made of pairs is accepted by the automaton if there is a path from state $0$ labeled with those pairs. See Figure~\\ref{fig1}. \\begin{figure}[htb] \\includegraphics[width=6.5in]{bal.pdf} \\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word.} \\label{fig1} \\end{figure} We have therefore shown \\begin{corollary} The automaton in Figure~\\ref{fig1} solves the balanced property for Fibonacci word rectangles. \\label{fibb} \\end{corollary} As an example, consider using the automaton to determine whether the $4 \\times 18$ blocks are balanced. We represent $4$ by $101$ in the Zeckendorf system and $18$ by $101000$. Padding the shorter with $0$ and entering the inputs in parallel $[0,1][0,0][0,1][1,0][0,0][1,0]$ into the automaton in Figure~\\ref{fig1}, we start at state $0$ and successively visit states $2, 6, 2, 7, 14$, and $7$ and accept. So $(m,n)$ is balanced. As a special case, we can now recover the theorem of Anselmo et al., as follows: \\begin{corollary} If $\\max(m,n)$ is a Fibonacci number then the $m \\times n$ matrices of ${\\cal A}_{\\gamma}$ are balanced. \\end{corollary} \\begin{proof} We use {\\tt Walnut}: \\begin{verbatim} reg isfib msd_fib \"0*10*\": # is input a Fibonacci number def max \"?msd_fib (z=m|z=n) & z>=m & z>=n\": # is z = max(x,y) eval anselmo \"?msd_fib Am,n,z ($max(m,n,z) & $isfib(z)) => $bal(m,n)\": # translation of their theorem \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} The {\\tt bal} automaton allows us to prove a wide variety of results about the $(m,n)$-balanced pairs for ${\\cal A}_{\\gamma}$. Here is one example. \\begin{proposition} Let $n \\geq 2$. \\begin{itemize} \\item[(a)] $(i,j)$ is balanced if and only if $(i',j)$ is balanced, for $F_{n+1} < i,i' < F_{n+2}$ and $j \\geq F_{n-1}$. \\item[(b)] $(F_{n+1} + i,j)$ is balanced if and only if $(F_{n+2} -i, j)$ is balanced, for $1 \\leq i < F_n$ and $j \\geq 1$. \\end{itemize} \\end{proposition} \\begin{proof} We use {\\tt Walnut}. For (a) we use the commands \\begin{verbatim} reg adjfib msd_fib msd_fib \"[0,0]*[0,1][1,0][0,0]*\": # accepts (F_n, F_{n+1}) for n>=2 eval claima \"?msd_fib Au,v,x,i,ip,j ($adjfib(u,v) & x=u+v & i>v & ip>v & i<x &ip<x & j>=v-u) => ($bal(i,j) <=> $bal(ip,j))\": # u = F_{n}, v = F_{n+1}, x = F_{n+2} \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. For (b) we use the commands \\begin{verbatim} eval claimb \"?msd_fib Au,v,x,i,j ($adjfib(u,v) & x=u+v & i>=1 & i<u & j>=1) => ($bal(v+i,j) <=> $bal(x-i,j))\": # u = F_n, v = F_{n+1}, x = F_{n+2} \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} We can also obtain a result about the density of balanced pairs $(m,n)$. \\begin{proposition} Suppose $F_i < m \\leq F_{i+1}$. Then for all $n\\geq 1$ there exists $j$, $1 \\leq j \\leq F_{i+1}$, such that $(m,n+j)$ is balanced. Furthermore the upper bound $F_{i+1}$ is optimal for each $m$. \\end{proposition} \\begin{proof} We use {\\tt Walnut}. \\begin{verbatim} eval density \"?msd_fib Am,x,y,n ($adjfib(x,y) & x<m & m<=y) => Ej j>=1 & j<=y & $bal(m,n+j)\": # x = F_i, y = F_{i+1} \\end{verbatim} which proves the first statement. To prove the second, we show that for each $m$ there exists $n$ such that the least $j\\geq 1$ with $(m,n+j)$ balanced is $\\geq F_{i+1}$. \\begin{verbatim} eval density2 \"?msd_fib Am,x,y ($adjfib(x,y) & x<m & m<=y) => (En Aj (j>=1 & j<y) => ~$bal(m,n+j))\": \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} These results essentially say that the density of $n$ for which $(m,n)$ is balanced is lower bounded by (approximately) $1 \\over {\\varphi m}$.",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    },
    {
      "content_type": "section",
      "title": "Another version of the criterion for balance",
      "content": "We can obtain a more ``human readable'' version of the criterion for the $m \\times n$ submatrices of $A_{\\gamma}$ to be balanced, as follows: \\begin{theorem} Assume $m \\leq n$ and let the Zeckendorf expansion of $m$ (resp., $n$) be $F_{a_1} + \\dots + F_{a_k}$ (resp., $ F_{b_1} + \\dots + F_{b_\\ell}$) for $a_1 > \\cdots >a_k$ and $b_1 > \\cdots > b_\\ell$. Then $(m,n)$ is accepted by {\\tt bal} if and only if at least one of the following cases holds: \\begin{itemize} \\item[(a)] $m = 0$ or $m = 1$; \\item[(b)] $m = F_{a_1}$ and $a_1 \\notin \\{b_1, \\ldots, b_\\ell\\}$ and for $b_j > a_1 > b_{j+1}$ the indices $a_1$ and $b_j$ have the same parity; \\item[(c)] $m = F_{a_1}$ and $a_1 \\in \\{b_1, \\ldots, b_\\ell\\}$; \\item[(d)] $a_1 = b_\\ell$, (i.e., the largest Fibonacci number in the representation of $m$ is the smallest Fibonacci number in the representation of $n$) and $b_\\ell$ and $b_{\\ell-1}$ have distinct parities; \\item[(e)] $a_1 < b_\\ell$ (i.e., the largest Fibonacci number in the representation of $m$ is smaller than the smallest Fibonacci number in the representation of $n$). \\end{itemize} \\end{theorem} \\begin{proof} To find the characterization we traced the paths in the automaton in Figure~\\ref{fig:colored}, which is the automaton {\\tt bal} from Figure~\\ref{fig1} restricted to $m \\leq n$. \\begin{figure}[htb] \\includegraphics[width=6.5in]{bala_colored.pdf} \\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word with $m \\leq n$.} \\label{fig:colored} \\end{figure} The {\\tt Walnut} code below verifies the characterization. Note that for simplicity, the regular expressions are not necessarily valid Zeckendorf representations. We can do this because eventually in {\\tt test} only the valid Zeckendorf representations are considered by {\\tt Walnut}. The mentioned colors are meant to help the interested reader find the paths in Figure~\\ref{fig:colored} corresponding to each regular expression. The ``upper part'' refers to the states $4,8$; the ``lower part'' to $2,5$ (and the state $10$ belongs to both). \\begin{verbatim} reg case_a msd_fib msd_fib \"([0,0]|[0,1])*|([0,0]|[0,1])*([1,0]|[1,1])\": reg case_b msd_fib msd_fib \"([0,0]|[0,1])*[0,1][0,0]([0,0][0,0])*[1,0]([0,0]|[0,1])*\": # lower part of red reg case_c msd_fib msd_fib \"([0,0]|[0,1])*[1,1]([0,0]|[0,1])*\": # dark blue, light blue, and the lower part of yellow reg case_d msd_fib msd_fib \"([0,0]|[0,1])*[0,1]([0,0][0,0])*[1,1]([0,0]|[1,0])*\": # upper part of yellow reg case_e msd_fib msd_fib \"([0,0]|[0,1])*([0,0]|[1,0])*\": # dark green, light green, and upper part of red eval test \"?msd_fib Am,n (m<=n) => (($case_a(m,n)|$case_b(m,n)|$case_c(m,n)|$case_d(m,n)|$case_e(m,n)) <=> $bal(m,n))\": \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof}",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    },
    {
      "content_type": "section",
      "title": "Diverse rectangles",
      "content": "\\label{diverse} \\begin{theorem} Consider the word rectangles formed from the Fibonacci word $\\bf f$ with the indexing $f_0 f_1 f_2 \\cdots = 0100$. The number of distinct values of $T(i,m,n)$, taken over all $i$, for $m = n = F_{3k}/2$, is at least $k+1$. \\label{bnd} \\end{theorem} \\begin{proof} We claim that \\begin{align} T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2) - T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2) &= 2n \\label{t1} \\\\ T((F_{6n+5}-1)/4, F_{6n+3}/2, F_{6n+3}/2) - T((F_{6n+2}-1)/4, F_{6n+3}/2, F_{6n+3}/2) &= 2n+1. \\label{t2} \\end{align} To prove these claims we use {\\tt Walnut} and its capabilities of producing linear representations. A linear representation for a function $f(n)$ is a triple $(v,\\zeta, w)$ where $v$ is a row vector, $w$ is a column vector, and $\\zeta$ is a matrix-valued morphism, such that $f(n) = v \\zeta(x) w$ for all representations of $x$ that evaluate to $n$. In this case, of course, $x$ is a Zeckendorf representation. Let us verify Eq.~\\eqref{t1}. We define three functions, as follows: \\begin{itemize} \\item $f(F_{6n}) = T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$, and $f(t)= 0$ for all other $t$. \\item $g(F_{6n}) = T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$, and $g(t)= 0$ for all other $t$. \\item $h(F_{6n}) = 6n$ for $n \\geq 1$, and $h(t)= 0$ for all other $t$. \\end{itemize} Then Eq.~\\eqref{t1} is equivalent to the claim that $3f(t)-3g(t)-h(t) = 0$ for all $t$. Our strategy is to construct linear representations for each of the functions $f(t)$, $g(t)$, and $h(t)$, using {\\tt Walnut}, and then combine them to find a linear representation for $3f(t)-3g(t)-h(t)$. Consider the following code: \\begin{verbatim} reg fib6 msd_fib \"0*1(000000)*0000\": def cnt6a t \"?msd_fib $fib6(t) & Ex,y $adjfib(t,x) & $adjfib(x,y) & F[(y-1)/4+j+k]=@1 & j<t/2 & k<t/2\": # t = F_{6n}, x = F_{6n+1}, y = F_{6n+2} def cnt6b t \"?msd_fib $fib6(t) & Eu $adjfib(u,t) & F[(u-1)/4+j+k]=@1 & j<t/2 & k<t/2\": # t = F_{6n}, u = F_{6n-1} def numfib \"?msd_fib Ey $adjfib(x,y) & i<=y & $isfib(i)\": def numfib6 t \"?msd_fib $fib6(t) & $numfib(i,t)\": \\end{verbatim} Here \\begin{itemize} \\item {\\tt fib6} accepts the Zeckendorf expansion of $F_{6n}$ for $n \\geq 1$. \\item {\\tt cnt6a} generates a linear representation of rank $123$ for the function $f(t)$. \\item {\\tt cnt6b} generates a linear representation of rank $121$ for the function $g(t)$. \\item {\\tt numfib}$(i,x)$ accepts if and only if $x = F_n$ for some $n \\geq 2$ and $i=n$. \\item {\\tt numfib6} creates a linear representation of rank $14$ for the function $h(t)$. \\end{itemize} In {\\tt Walnut} these linear representations are provided as {\\tt Maple} files. From these linear representations we can easily compute, through standard matrix methods, a linear representation of rank $258 = 123 + 121 + 14$ for $3g(t) - 3f(t) - h(t)$. There is an algorithm to decide if a given linear representation represents the $0$ function \\cite{Berstel&Reutenauer:2011}. We use {\\tt Walnut} to create the representations and then a {\\tt Maple} program to check if $3f(t)-3g(t)-h(t)$ is identically $0$. This proves Eq.~\\eqref{t1}, and Eq.~\\eqref{t2} follows in a similar manner. \\end{proof} \\begin{corollary} The number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Theta(n)$. \\end{corollary} \\begin{proof} From a result of Berth\\'e and Tijdeman \\cite{Berthe} we know that the number of distinct values of $T(i,x,x)$ is $O(\\log x)$. From Theorem~\\ref{bnd} we know the number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Omega(n)$. Combining these gives the result. \\end{proof}",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    },
    {
      "content_type": "section",
      "title": "Acknowledgment",
      "content": "We acknowledge with thanks discussions with Narad Rampersad. \\begin{thebibliography}{10} \\expandafter\\ifx\\csname url\\endcsname\\relax \\def\\url#1{\\texttt{#1}}\\fi \\expandafter\\ifx\\csname doi\\endcsname\\relax \\def\\doi#1{\\burlalt{doi:#1}{http://dx.doi.org/#1}}\\fi \\expandafter\\ifx\\csname urlprefix\\endcsname\\relax\\def\\urlprefix{URL: }\\fi \\expandafter\\ifx\\csname href\\endcsname\\relax \\def\\href#1#2{#2}\\fi \\expandafter\\ifx\\csname burlalt\\endcsname\\relax \\def\\burlalt#1#2{\\href{#2}{#1}}\\fi \\bibitem{Allouche&Shallit:2003} J.-P. Allouche and J.~Shallit. \\newblock {\\em Automatic Sequences: Theory, Applications, Generalizations}. \\newblock Cambridge University Press, 2003. \\bibitem{Anselmo} M.~Anselmo, D.~Giammarresi, M.~Madonia, and C.~Selmi. \\newblock Fibonacci pictures on a binary alphabet. \\newblock In A.~Malcher and L.~Prigioniero, editors, {\\em DCFS 2025}, volume 15759 of {\\em Lecture Notes in Computer Science}, pages 1--16. Springer-Verlag, 2025. \\bibitem{Berstel:1986b} J.~Berstel. \\newblock Fibonacci words---a survey. \\newblock In G.~Rozenberg and A.~Salomaa, editors, {\\em The Book of L}, pages 13--27. Springer-Verlag, 1986. \\bibitem{Berstel&Reutenauer:2011} J.~Berstel and C.~Reutenauer. \\newblock {\\em Noncommutative Rational Series With Applications}, volume 137 of {\\em Encyclopedia of Mathematics and Its Applications}. \\newblock Cambridge Univ. Press, 2011. \\bibitem{Berstel&Seebold:2002} J.~Berstel and P.~{S\\'e\\'ebold}. \\newblock Sturmian words. \\newblock In M.~Lothaire, editor, {\\em Algebraic Combinatorics on Words}, pages 45--110. Cambridge University Press, 2002. \\bibitem{Berthe} V.~Berth{\\'e} and R.~Tijdeman. \\newblock Balance properties of multi-dimensional words. \\newblock {\\em Theoret. Comput. Sci.}, 273:197--224, 2002. \\bibitem{BrownT:1993} T.~C. Brown. \\newblock Descriptions of the characteristic sequence of an irrational. \\newblock {\\em Canad. Math. Bull.}, 36:15--21, 1993. \\bibitem{Bruyere&Hansel&Michaux&Villemaire:1994} V.~{Bruy\\`ere}, G.~Hansel, C.~Michaux, and R.~Villemaire. \\newblock Logic and $p$-recognizable sets of integers. \\newblock {\\em Bull. Belgian Math. Soc.}, 1:191--238, 1994. \\newblock Corrigendum, {\\it Bull.\\ Belgian\\ Math.\\ Soc.} {\\bf 1} (1994), 577. \\bibitem{Lekkerkerker:1952} C.~G. Lekkerkerker. \\newblock Voorstelling van natuurlijke getallen door een som van getallen van {Fibonacci}. \\newblock {\\em Simon Stevin}, 29:190--195, 1952. \\bibitem{Markovsky:2019} I.~Markovsky. \\newblock {\\em Low-Rank Approximation: Algorithms, Implementation, Applications}. \\newblock Springer-Verlag, 2nd edition, 2019. \\bibitem{Mousavi:2016} H.~Mousavi. \\newblock Automatic theorem proving in \\texttt{{{Walnut}}}. \\newblock ArXiv preprint arXiv:1603.06017 [cs.FL], 2016. \\newblock \\urlprefix\\url{http://arxiv.org/abs/1603.06017}. \\bibitem{Schaeffer&Shallit&Zorcic:2024} L.~Schaeffer, J.~Shallit, and S.~Zorcic. \\newblock Beatty sequences for a quadratic irrational: decidability and applications. \\newblock Arxiv preprint arXiv:2402.08331 [math.NT]. Available at \\url{https://arxiv.org/abs/2402.08331}, 2024. \\bibitem{Shallit:2021} J.~Shallit. \\newblock Synchronized sequences. \\newblock In T.~Lecroq and S.~Puzynina, editors, {\\em WORDS 2021}, volume 12847 of {\\em Lecture Notes in Computer Science}, pages 1--19. Springer-Verlag, 2021. \\newblock \\doi{10.1007/978-3-030-85088-3_1}. \\bibitem{Shallit:2023} J.~Shallit. \\newblock {\\em The Logical Approach To Automatic Sequences: Exploring Combinatorics on Words with {\\tt Walnut}}, volume 482 of {\\em London Mathematical Society Lecture Note Series}. \\newblock Cambridge University Press, 2023. \\bibitem{Vuillon:2003} L.~Vuillon. \\newblock Balanced words. \\newblock {\\em Bull. Belgian Math. Soc.}, 10(5):787--805, 12 2003. \\newblock \\doi{10.36045/bbms/1074791332}. \\bibitem{Zeckendorf:1972} E.~Zeckendorf. \\newblock {Repr\\'esentation} des nombres naturels par une somme de nombres de {Fibonacci} ou de nombres de {Lucas}. \\newblock {\\em Bull. Soc. Roy. {Li\\`ege}}, 41:179--182, 1972. \\end{thebibliography} \\appendix",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    },
    {
      "content_type": "section",
      "title": "{\\tt Walnut",
      "content": "commands} The three principal {\\tt Walnut} commands used in this paper are \\begin{itemize} \\item {\\tt reg}: defines a regular expression; \\item {\\tt def}: defines an automaton for later use; \\item {\\tt def}: evaluates a first-order logical statement with no free variables as {\\tt TRUE} or {\\tt FALSE}. \\end{itemize} The jargon {\\tt ?msd\\_fib} at the beginning of a command tells {\\tt Walnut} that numbers are represented in the Zeckendorf numeration system. Logical AND $(\\wedge)$ is represented by {\\tt \\&}; logical OR $(\\vee)$ is represented by {\\tt |}; logical NOT $(\\neg)$ is represented by {\\tt \\char'176}; implication is represented by {\\tt =>}; and logical IFF is represented by {\\tt <=>}. The capital letter {\\tt A} is the universal quantifier $\\forall$; the capital letter {\\tt E} is the existential quantifier $\\exists$. Comments are denoted with the symbol {\\tt \\#}. When an automaton is defined as a function of its unbound variables, it may be reused and the order of the arguments is the alphabetical order of the variable names used when it was defined. The capital letter {\\tt F} refers to the Fibonacci word ${\\bf f} = 01001\\cdots$, indexed starting at $0$. \\end{document}",
      "section_number": null,
      "theorem_number": null,
      "line_start": null,
      "line_end": null
    }
  ],
  "theorems": [
    {
      "statement_type": "theorem",
      "number": null,
      "title": null,
      "statement": "There is an algorithm that, given a quadratic irrational $\\alpha$ with $0 < \\alpha < 1$, constructs a finite automaton that takes as input pairs $(m,n)$, represented in the Ostrowski $\\alpha$-numeration system, and accepts if and only if the $m \\times n$ blocks of the Sturmian matrix ${\\cal A}_{\\alpha}$ are balanced. \\label{main}",
      "proof": null,
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "theorem",
      "number": null,
      "title": null,
      "statement": "Assume $m \\leq n$ and let the Zeckendorf expansion of $m$ (resp., $n$) be $F_{a_1} + \\dots + F_{a_k}$ (resp., $ F_{b_1} + \\dots + F_{b_\\ell}$) for $a_1 > \\cdots >a_k$ and $b_1 > \\cdots > b_\\ell$. Then $(m,n)$ is accepted by {\\tt bal} if and only if at least one of the following cases holds: ((a)) $m = 0$ or $m = 1$; ((b)) $m = F_{a_1}$ and $a_1 \\notin \\{b_1, \\ldots, b_\\ell\\}$ and for $b_j > a_1 > b_{j+1}$ the indices $a_1$ and $b_j$ have the same parity; ((c)) $m = F_{a_1}$ and $a_1 \\in \\{b_1, \\ldots, b_\\ell\\}$; ((d)) $a_1 = b_\\ell$, (i.e., the largest Fibonacci number in the representation of $m$ is the smallest Fibonacci number in the representation of $n$) and $b_\\ell$ and $b_{\\ell-1}$ have distinct parities; ((e)) $a_1 < b_\\ell$ (i.e., the largest Fibonacci number in the representation of $m$ is smaller than the smallest Fibonacci number in the representation of $n$).",
      "proof": "To find the characterization we traced the paths in the automaton in Figure~\\ref{fig:colored}, which is the automaton {\\tt bal} from Figure~\\ref{fig1} restricted to $m \\leq n$. \\begin{figure}[htb] \\includegraphics[width=6.5in]{bala_colored.pdf} \\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word with $m \\leq n$.} \\label{fig:colored} \\end{figure} The {\\tt Walnut} code below verifies the characterization. Note that for simplicity, the regular expressions are not necessarily valid Zeckendorf representations. We can do this because eventually in {\\tt test} only the valid Zeckendorf representations are considered by {\\tt Walnut}. The mentioned colors are meant to help the interested reader find the paths in Figure~\\ref{fig:colored} corresponding to each regular expression. The ``upper part'' refers to the states $4,8$; the ``lower part'' to $2,5$ (and the state $10$ belongs to both). \\begin{verbatim} reg case_a msd_fib msd_fib \"([0,0]|[0,1])*|([0,0]|[0,1])*([1,0]|[1,1])\": reg case_b msd_fib msd_fib \"([0,0]|[0,1])*[0,1][0,0]([0,0][0,0])*[1,0]([0,0]|[0,1])*\": # lower part of red reg case_c msd_fib msd_fib \"([0,0]|[0,1])*[1,1]([0,0]|[0,1])*\": # dark blue, light blue, and the lower part of yellow reg case_d msd_fib msd_fib \"([0,0]|[0,1])*[0,1]([0,0][0,0])*[1,1]([0,0]|[1,0])*\": # upper part of yellow reg case_e msd_fib msd_fib \"([0,0]|[0,1])*([0,0]|[1,0])*\": # dark green, light green, and upper part of red eval test \"?msd_fib Am,n (m<=n) => (($case_a(m,n)|$case_b(m,n)|$case_c(m,n)|$case_d(m,n)|$case_e(m,n)) <=> $bal(m,n))\": \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}.",
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "theorem",
      "number": null,
      "title": null,
      "statement": "Consider the word rectangles formed from the Fibonacci word $\\bf f$ with the indexing $f_0 f_1 f_2 \\cdots = 0100$. The number of distinct values of $T(i,m,n)$, taken over all $i$, for $m = n = F_{3k}/2$, is at least $k+1$. \\label{bnd}",
      "proof": "We claim that \\begin{align} T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2) - T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2) &= 2n \\label{t1} \\\\ T((F_{6n+5}-1)/4, F_{6n+3}/2, F_{6n+3}/2) - T((F_{6n+2}-1)/4, F_{6n+3}/2, F_{6n+3}/2) &= 2n+1. \\label{t2} \\end{align} To prove these claims we use {\\tt Walnut} and its capabilities of producing linear representations. A linear representation for a function $f(n)$ is a triple $(v,\\zeta, w)$ where $v$ is a row vector, $w$ is a column vector, and $\\zeta$ is a matrix-valued morphism, such that $f(n) = v \\zeta(x) w$ for all representations of $x$ that evaluate to $n$. In this case, of course, $x$ is a Zeckendorf representation. Let us verify Eq.~\\eqref{t1}. We define three functions, as follows: \\begin{itemize} \\item $f(F_{6n}) = T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$, and $f(t)= 0$ for all other $t$. \\item $g(F_{6n}) = T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$, and $g(t)= 0$ for all other $t$. \\item $h(F_{6n}) = 6n$ for $n \\geq 1$, and $h(t)= 0$ for all other $t$. \\end{itemize} Then Eq.~\\eqref{t1} is equivalent to the claim that $3f(t)-3g(t)-h(t) = 0$ for all $t$. Our strategy is to construct linear representations for each of the functions $f(t)$, $g(t)$, and $h(t)$, using {\\tt Walnut}, and then combine them to find a linear representation for $3f(t)-3g(t)-h(t)$. Consider the following code: \\begin{verbatim} reg fib6 msd_fib \"0*1(000000)*0000\": def cnt6a t \"?msd_fib $fib6(t) & Ex,y $adjfib(t,x) & $adjfib(x,y) & F[(y-1)/4+j+k]=@1 & j<t/2 & k<t/2\": # t = F_{6n}, x = F_{6n+1}, y = F_{6n+2} def cnt6b t \"?msd_fib $fib6(t) & Eu $adjfib(u,t) & F[(u-1)/4+j+k]=@1 & j<t/2 & k<t/2\": # t = F_{6n}, u = F_{6n-1} def numfib \"?msd_fib Ey $adjfib(x,y) & i<=y & $isfib(i)\": def numfib6 t \"?msd_fib $fib6(t) & $numfib(i,t)\": \\end{verbatim} Here \\begin{itemize} \\item {\\tt fib6} accepts the Zeckendorf expansion of $F_{6n}$ for $n \\geq 1$. \\item {\\tt cnt6a} generates a linear representation of rank $123$ for the function $f(t)$. \\item {\\tt cnt6b} generates a linear representation of rank $121$ for the function $g(t)$. \\item {\\tt numfib}$(i,x)$ accepts if and only if $x = F_n$ for some $n \\geq 2$ and $i=n$. \\item {\\tt numfib6} creates a linear representation of rank $14$ for the function $h(t)$. \\end{itemize} In {\\tt Walnut} these linear representations are provided as {\\tt Maple} files. From these linear representations we can easily compute, through standard matrix methods, a linear representation of rank $258 = 123 + 121 + 14$ for $3g(t) - 3f(t) - h(t)$. There is an algorithm to decide if a given linear representation represents the $0$ function \\cite{Berstel&Reutenauer:2011}. We use {\\tt Walnut} to create the representations and then a {\\tt Maple} program to check if $3f(t)-3g(t)-h(t)$ is identically $0$. This proves Eq.~\\eqref{t1}, and Eq.~\\eqref{t2} follows in a similar manner.",
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "lemma",
      "number": null,
      "title": null,
      "statement": "If $(a_i)_{i \\geq 0}$ is a Sturmian word corresponding to the irrational number $\\alpha$, then in the matrix ${\\cal A}_\\alpha = (a_{i,j})_{i,j\\geq 0}$ the $m \\times n$ blocks are balanced if and only if the sequence $\\Delta(i,m,n)$ has no blocks of the form $1,0,0,\\ldots, 0,1$ or $-1,0,0,\\ldots,0, -1$. \\label{lemma1}",
      "proof": "The only thing left to show is that $(\\Delta(i,m,n))_{i \\geq 0}$ has a block of the form $1,0,0,\\ldots, 0,1$ or $-1,0,0,\\ldots,0, -1$ if and only if $(m,n)$ is not balanced. Suppose it does have a block of the form $a,0,0,\\ldots,0,a$ for $a \\in \\{ -1, 1\\}$; say there are indices $i < j$ such that $\\Delta(i,m,n) = a$, $\\Delta(j,m,n) = a$ and $\\Delta(k,m,n) = 0$ for $i<k<j$. Then by telescoping cancellation we have $T(j+1,m,n)= T(i,m,n) + 2a$, proving that $(m,n)$ is not balanced. Now suppose $(m,n)$ is not balanced, meaning that there exist $i< j$ such that $|T(i,m,n) - T(j+1,m,n)| \\geq 2$. Without loss of generality we may assume that $j-i$ is as small as possible. Since from Eq.~\\eqref{bnd2} we know that $\\Delta(i,m,n) \\in \\{-1,0,1\\}$, it follows that we must have $\\Delta(j) = a$, $\\Delta(i) = a$, and $\\Delta(k) = 0$ for $i < k < j$ and $a \\in \\{-1,1\\}$.",
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "proposition",
      "number": null,
      "title": null,
      "statement": "Let $n \\geq 2$. ((a)) $(i,j)$ is balanced if and only if $(i',j)$ is balanced, for $F_{n+1} < i,i' < F_{n+2}$ and $j \\geq F_{n-1}$. ((b)) $(F_{n+1} + i,j)$ is balanced if and only if $(F_{n+2} -i, j)$ is balanced, for $1 \\leq i < F_n$ and $j \\geq 1$.",
      "proof": "We use {\\tt Walnut}. For (a) we use the commands \\begin{verbatim} reg adjfib msd_fib msd_fib \"[0,0]*[0,1][1,0][0,0]*\": # accepts (F_n, F_{n+1}) for n>=2 eval claima \"?msd_fib Au,v,x,i,ip,j ($adjfib(u,v) & x=u+v & i>v & ip>v & i<x &ip<x & j>=v-u) => ($bal(i,j) <=> $bal(ip,j))\": # u = F_{n}, v = F_{n+1}, x = F_{n+2} \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. For (b) we use the commands \\begin{verbatim} eval claimb \"?msd_fib Au,v,x,i,j ($adjfib(u,v) & x=u+v & i>=1 & i<u & j>=1) => ($bal(v+i,j) <=> $bal(x-i,j))\": # u = F_n, v = F_{n+1}, x = F_{n+2} \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}.",
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "proposition",
      "number": null,
      "title": null,
      "statement": "Suppose $F_i < m \\leq F_{i+1}$. Then for all $n\\geq 1$ there exists $j$, $1 \\leq j \\leq F_{i+1}$, such that $(m,n+j)$ is balanced. Furthermore the upper bound $F_{i+1}$ is optimal for each $m$.",
      "proof": "We use {\\tt Walnut}. \\begin{verbatim} eval density \"?msd_fib Am,x,y,n ($adjfib(x,y) & x<m & m<=y) => Ej j>=1 & j<=y & $bal(m,n+j)\": # x = F_i, y = F_{i+1} \\end{verbatim} which proves the first statement. To prove the second, we show that for each $m$ there exists $n$ such that the least $j\\geq 1$ with $(m,n+j)$ balanced is $\\geq F_{i+1}$. \\begin{verbatim} eval density2 \"?msd_fib Am,x,y ($adjfib(x,y) & x<m & m<=y) => (En Aj (j>=1 & j<y) => ~$bal(m,n+j))\": \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}.",
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "corollary",
      "number": null,
      "title": null,
      "statement": "The automaton in Figure~\\ref{fig1} solves the balanced property for Fibonacci word rectangles. \\label{fibb}",
      "proof": null,
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "corollary",
      "number": null,
      "title": null,
      "statement": "If $\\max(m,n)$ is a Fibonacci number then the $m \\times n$ matrices of ${\\cal A}_{\\gamma}$ are balanced.",
      "proof": "We use {\\tt Walnut}: \\begin{verbatim} reg isfib msd_fib \"0*10*\": # is input a Fibonacci number def max \"?msd_fib (z=m|z=n) & z>=m & z>=n\": # is z = max(x,y) eval anselmo \"?msd_fib Am,n,z ($max(m,n,z) & $isfib(z)) => $bal(m,n)\": # translation of their theorem \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}.",
      "line_start": null,
      "line_end": null
    },
    {
      "statement_type": "corollary",
      "number": null,
      "title": null,
      "statement": "The number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Theta(n)$.",
      "proof": "From a result of Berth\\'e and Tijdeman \\cite{Berthe} we know that the number of distinct values of $T(i,x,x)$ is $O(\\log x)$. From Theorem~\\ref{bnd} we know the number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Omega(n)$. Combining these gives the result.",
      "line_start": null,
      "line_end": null
    }
  ],
  "references": "\\begin{thebibliography}{10} \\expandafter\\ifx\\csname url\\endcsname\\relax \\def\\url#1{\\texttt{#1}}\\fi \\expandafter\\ifx\\csname doi\\endcsname\\relax \\def\\doi#1{\\burlalt{doi:#1}{http://dx.doi.org/#1}}\\fi \\expandafter\\ifx\\csname urlprefix\\endcsname\\relax\\def\\urlprefix{URL: }\\fi \\expandafter\\ifx\\csname href\\endcsname\\relax \\def\\href#1#2{#2}\\fi \\expandafter\\ifx\\csname burlalt\\endcsname\\relax \\def\\burlalt#1#2{\\href{#2}{#1}}\\fi \\bibitem{Allouche&Shallit:2003} J.-P. Allouche and J.~Shallit. \\newblock {\\em Automatic Sequences: Theory, Applications, Generalizations}. \\newblock Cambridge University Press, 2003. \\bibitem{Anselmo} M.~Anselmo, D.~Giammarresi, M.~Madonia, and C.~Selmi. \\newblock Fibonacci pictures on a binary alphabet. \\newblock In A.~Malcher and L.~Prigioniero, editors, {\\em DCFS 2025}, volume 15759 of {\\em Lecture Notes in Computer Science}, pages 1--16. Springer-Verlag, 2025. \\bibitem{Berstel:1986b} J.~Berstel. \\newblock Fibonacci words---a survey. \\newblock In G.~Rozenberg and A.~Salomaa, editors, {\\em The Book of L}, pages 13--27. Springer-Verlag, 1986. \\bibitem{Berstel&Reutenauer:2011} J.~Berstel and C.~Reutenauer. \\newblock {\\em Noncommutative Rational Series With Applications}, volume 137 of {\\em Encyclopedia of Mathematics and Its Applications}. \\newblock Cambridge Univ. Press, 2011. \\bibitem{Berstel&Seebold:2002} J.~Berstel and P.~{S\\'e\\'ebold}. \\newblock Sturmian words. \\newblock In M.~Lothaire, editor, {\\em Algebraic Combinatorics on Words}, pages 45--110. Cambridge University Press, 2002. \\bibitem{Berthe} V.~Berth{\\'e} and R.~Tijdeman. \\newblock Balance properties of multi-dimensional words. \\newblock {\\em Theoret. Comput. Sci.}, 273:197--224, 2002. \\bibitem{BrownT:1993} T.~C. Brown. \\newblock Descriptions of the characteristic sequence of an irrational. \\newblock {\\em Canad. Math. Bull.}, 36:15--21, 1993. \\bibitem{Bruyere&Hansel&Michaux&Villemaire:1994} V.~{Bruy\\`ere}, G.~Hansel, C.~Michaux, and R.~Villemaire. \\newblock Logic and $p$-recognizable sets of integers. \\newblock {\\em Bull. Belgian Math. Soc.}, 1:191--238, 1994. \\newblock Corrigendum, {\\it Bull.\\ Belgian\\ Math.\\ Soc.} {\\bf 1} (1994), 577. \\bibitem{Lekkerkerker:1952} C.~G. Lekkerkerker. \\newblock Voorstelling van natuurlijke getallen door een som van getallen van {Fibonacci}. \\newblock {\\em Simon Stevin}, 29:190--195, 1952. \\bibitem{Markovsky:2019} I.~Markovsky. \\newblock {\\em Low-Rank Approximation: Algorithms, Implementation, Applications}. \\newblock Springer-Verlag, 2nd edition, 2019. \\bibitem{Mousavi:2016} H.~Mousavi. \\newblock Automatic theorem proving in \\texttt{{{Walnut}}}. \\newblock ArXiv preprint arXiv:1603.06017 [cs.FL], 2016. \\newblock \\urlprefix\\url{http://arxiv.org/abs/1603.06017}. \\bibitem{Schaeffer&Shallit&Zorcic:2024} L.~Schaeffer, J.~Shallit, and S.~Zorcic. \\newblock Beatty sequences for a quadratic irrational: decidability and applications. \\newblock Arxiv preprint arXiv:2402.08331 [math.NT]. Available at \\url{https://arxiv.org/abs/2402.08331}, 2024. \\bibitem{Shallit:2021} J.~Shallit. \\newblock Synchronized sequences. \\newblock In T.~Lecroq and S.~Puzynina, editors, {\\em WORDS 2021}, volume 12847 of {\\em Lecture Notes in Computer Science}, pages 1--19. Springer-Verlag, 2021. \\newblock \\doi{10.1007/978-3-030-85088-3_1}. \\bibitem{Shallit:2023} J.~Shallit. \\newblock {\\em The Logical Approach To Automatic Sequences: Exploring Combinatorics on Words with {\\tt Walnut}}, volume 482 of {\\em London Mathematical Society Lecture Note Series}. \\newblock Cambridge University Press, 2023. \\bibitem{Vuillon:2003} L.~Vuillon. \\newblock Balanced words. \\newblock {\\em Bull. Belgian Math. Soc.}, 10(5):787--805, 12 2003. \\newblock \\doi{10.36045/bbms/1074791332}. \\bibitem{Zeckendorf:1972} E.~Zeckendorf. \\newblock {Repr\\'esentation} des nombres naturels par une somme de nombres de {Fibonacci} ou de nombres de {Lucas}. \\newblock {\\em Bull. Soc. Roy. {Li\\`ege}}, 41:179--182, 1972. \\end{thebibliography}",
  "full_content": "\\documentclass[12pt,reqno]{article} \\usepackage[usenames]{color} \\usepackage{amssymb} \\usepackage{amsmath} \\usepackage{amsthm} \\usepackage{amsfonts} \\usepackage{amscd} \\usepackage{graphicx} \\usepackage[colorlinks=true, linkcolor=webgreen, filecolor=webbrown, citecolor=webgreen]{hyperref} \\definecolor{webgreen}{rgb}{0,.5,0} \\definecolor{webbrown}{rgb}{.6,0,0} \\usepackage{color} \\usepackage{fullpage} \\usepackage{float} \\usepackage{graphics} \\usepackage{latexsym} \\usepackage{epsf} \\usepackage{breakurl} \\setlength{\\textwidth}{6.5in} \\setlength{\\oddsidemargin}{.1in} \\setlength{\\evensidemargin}{.1in} \\setlength{\\topmargin}{-.1in} \\setlength{\\textheight}{8.4in} \\newcommand{\\seqnum}[1]{\\href{https://oeis.org/#1}{\\rm \\underline{#1}}} \\usepackage{mathtools} \\usepackage{bbm} \\usepackage{enumerate} \\DeclarePairedDelimiter\\ceil{\\lceil}{\\rceil} \\DeclarePairedDelimiter\\floor{\\lfloor}{\\rfloor} \\DeclarePairedDelimiter\\abs{\\lvert}{\\rvert} \\begin{document} \\title{Balanced Fibonacci word rectangles, and beyond} \\author{Jeffrey Shallit\\footnote{Research supported by NSERC grant 2024-03725.}\\\\ School of Computer Science\\\\ University of Waterloo\\\\ Waterloo, ON N2L 3G1 \\\\ Canada\\\\ \\href{mailto:shallit@uwaterloo.ca}{\\tt shallit@uwaterloo.ca} \\and Ingrid Vukusic\\footnote{Research funded by the Austrian Science Fund (FWF) grant J 4850-N.}\\\\ Department of Mathematics\\\\ University of York\\\\ York, North Yorkshire YO10 5GH\\\\ United Kingdom\\\\ \\href{mailto:ingrid.vukusic@york.ac.uk}{\\tt ingrid.vukusic@york.ac.uk}.} \\maketitle \\theoremstyle{plain} \\newtheorem{theorem}{Theorem} \\newtheorem{corollary}[theorem]{Corollary} \\newtheorem{lemma}[theorem]{Lemma} \\newtheorem{proposition}[theorem]{Proposition} \\theoremstyle{definition} \\newtheorem{definition}[theorem]{Definition} \\newtheorem{example}[theorem]{Example} \\newtheorem{conjecture}[theorem]{Conjecture} \\theoremstyle{remark} \\newtheorem{remark}[theorem]{Remark} \\begin{abstract} Following a recent paper of Anselmo et al., we consider $m \\times n$ rectangular matrices formed from the Fibonacci word, and we show that their balance properties can be solved with a finite automaton. We also generalize the result to every Sturmian characteristic word corresponding to a quadratic irrational. \\end{abstract} \\section{Introduction} Let $(a_i)_{i \\geq 0}$ be an infinite sequence over $\\{0,1\\}$. We can define an infinite matrix ${\\cal A} =(a_{k,\\ell})_{k,\\ell\\geq 0}$ by $a_{k,\\ell} = a_{k+\\ell}$. Then we can view the $m \\times n$ submatrices of $\\cal A$ as matrices where the successive rows form shifted length-$n$ ``windows'' of $(a_i)_{i \\geq 0}$, and the entry in the upper left corner has index sum $i$: \\[ A(i,m,n) := \\begin{pmatrix} a_i & a_{i+1} & \\dots & a_{i+n-1} \\\\ a_{i+1} & a_{i+2} & \\dots & a_{i+n} \\\\ \\vdots & \\vdots & & \\vdots \\\\ a_{i+m-1} & a_{i+m} & \\dots & a_{i+m+n-2} \\\\ \\end{pmatrix}. \\] These are sometimes called Hankel matrices in the literature \\cite{Markovsky:2019}. The sum over all entries in the matrix $A(i,m,n)$ equals \\begin{equation} T(i,m,n) := \\sum_{k = 0}^{m-1} \\sum_{\\ell = 0}^{n-1} a_{i+k+\\ell}. \\label{sum} \\end{equation} It is clear that $A(i,m,n) = A(i,n,m)$ for all $i,m,n$. The {\\it balance problem\\/} for $(a_i)_{i \\geq 0}$ is the following: for which pairs of natural numbers $(m,n)$ are there at most two distinct values among all the $(T(i,m,n))_{i \\geq 0}$? If this is the case, we say that the $(m,n)$-submatrices of $A$ are {\\it balanced with respect to each other\\/} or just that $(m,n)$ is {\\it balanced}. This is a generalization of a more familiar notion of balance for binary words, one that has been well-studied \\cite{Vuillon:2003}. The famous infinite Fibonacci word ${\\bf f} = f_0 f_1 f_2\\cdots = 01001010\\cdots$ has been the subject of numerous papers \\cite{Berstel:1986b}. It can be defined via the formula \\[ f_{n-1} = \\floor{(n+1)\\gamma} - \\floor{n \\gamma} \\in \\{0,1\\}, \\] for $n \\geq 1$, where $\\gamma = (3- \\sqrt{5})/2$. Recently Anselmo et al.~\\cite{Anselmo} showed the following (their Theorem 18): for $m,n \\geq 2$, if $\\max(m,n)$ is a Fibonacci number, then the $m \\times n$ blocks of ${\\cal A}_{\\gamma}$ are balanced. Also see \\cite{Berthe}. However, there are still other $(m,n)$ pairs with the balance property, such as $(4,3)$. This raises the natural question, which $(m,n)$ pairs are balanced for the Fibonacci word? In this note we prove a theorem (Corollary~\\ref{fibb}) characterizing exactly those pairs $(m,n)$ that are balanced. Our characterization is in terms of finite automata. The particular result of Anselmo et al.\\ then follows as a special case. More generally, we show how the same sort of characterization can be obtained for the matrices formed from any Sturmian word corresponding to a quadratic irrational $\\alpha$, and we show how to implement this in the free software {\\tt Walnut}. \\section{Sturmian words} Let $\\alpha \\in (0,1)$ be an irrational number, and define $$a_i = \\lfloor (i+1) \\alpha \\rfloor - \\lfloor i \\alpha \\rfloor$$ for $i \\geq 1$. The infinite word $(a_i)_{i \\geq 1}$ is sometimes called a Sturmian characteristic word \\cite{BrownT:1993,Berstel&Seebold:2002}. Although by convention Sturmian words are indexed starting at $1$, we can define $a_0 = 0$ without creating any new blocks that do not already appear in $\\bf f$, by a well-known result \\cite[2.1.18]{Berstel&Seebold:2002}. We now define the infinite matrix ${\\cal A}_{\\alpha}$ from the terms of $(a_i)_{i \\geq 1}$; we call $A_{\\alpha}$ a Sturmian matrix. By telescoping cancellation we see that $$\\sum_{j \\leq i \\leq k} a_i = \\lfloor (k+1) \\alpha \\rfloor - \\lfloor j \\alpha \\rfloor .$$ Hence, from the definition \\eqref{sum}, we get \\begin{align} T(i+1,m,n) - T(i,m,n) &= (a_{i+n} + \\dots + a_{i+m+n-1}) - (a_{i} + \\dots + a_{i+m-1})\\nonumber\\\\ &= (\\floor{(i+m+n)\\alpha} - \\floor{(i+n)\\alpha}) - (\\floor{(i+m)\\alpha} - \\floor{i \\alpha}). \\label{fund} \\end{align} Note that for all $x,y\\geq 0$ we have $\\floor{x+y} = \\floor{x} + \\floor{y} + \\delta$ with $\\delta \\in \\{0,1\\}$. Therefore, $\\floor{(i+m+n)\\alpha} - \\floor{(i+n)\\alpha} = \\floor{m \\alpha} + \\delta_1$ and $\\floor{(i+m)\\alpha} - \\floor{i \\alpha} = \\floor{m \\alpha} + \\delta_2$, with $\\delta_1, \\delta_2 \\in \\{0,1\\}$. Thus, \\begin{equation} T(i+1,m,n) - T(i,m,n) = \\delta_1 - \\delta_2 \\in \\{-1,0,1\\}. \\label{bnd2} \\end{equation} Define $\\Delta(i,m,n) := T(i+1,m,n)-T(i,m,n)$. The argument above then gives the following criterion for $A(i,m,n)$ to be balanced. \\begin{lemma} If $(a_i)_{i \\geq 0}$ is a Sturmian word corresponding to the irrational number $\\alpha$, then in the matrix ${\\cal A}_\\alpha = (a_{i,j})_{i,j\\geq 0}$ the $m \\times n$ blocks are balanced if and only if the sequence $\\Delta(i,m,n)$ has no blocks of the form $1,0,0,\\ldots, 0,1$ or $-1,0,0,\\ldots,0, -1$. \\label{lemma1} \\end{lemma} \\begin{proof} The only thing left to show is that $(\\Delta(i,m,n))_{i \\geq 0}$ has a block of the form $1,0,0,\\ldots, 0,1$ or $-1,0,0,\\ldots,0, -1$ if and only if $(m,n)$ is not balanced. Suppose it does have a block of the form $a,0,0,\\ldots,0,a$ for $a \\in \\{ -1, 1\\}$; say there are indices $i < j$ such that $\\Delta(i,m,n) = a$, $\\Delta(j,m,n) = a$ and $\\Delta(k,m,n) = 0$ for $i<k<j$. Then by telescoping cancellation we have $T(j+1,m,n)= T(i,m,n) + 2a$, proving that $(m,n)$ is not balanced. Now suppose $(m,n)$ is not balanced, meaning that there exist $i< j$ such that $|T(i,m,n) - T(j+1,m,n)| \\geq 2$. Without loss of generality we may assume that $j-i$ is as small as possible. Since from Eq.~\\eqref{bnd2} we know that $\\Delta(i,m,n) \\in \\{-1,0,1\\}$, it follows that we must have $\\Delta(j) = a$, $\\Delta(i) = a$, and $\\Delta(k) = 0$ for $i < k < j$ and $a \\in \\{-1,1\\}$. \\end{proof} \\section{Finite automata} Now suppose $\\alpha \\in (0,1)$ is a quadratic irrational. Then, as shown in \\cite{Schaeffer&Shallit&Zorcic:2024}, there is an algorithm to find a finite automaton $M$ that takes $n$ and $x$ in parallel as inputs, represented in a certain numeration system, and accepts if and only if $x = \\lfloor n \\alpha \\rfloor$. The numeration system required is the so-called Ostrowski $\\alpha$-numeration system, as discussed, for example, in \\cite[\\S 3.9]{Allouche&Shallit:2003}. Furthermore, we also know that we can algorithmically translate a first-order logical formula $\\cal F$ involving addition, subtraction, comparisons, and other automata, into an automaton accepting the values of the free variables making $\\cal F$ true \\cite{Bruyere&Hansel&Michaux&Villemaire:1994}. One strategy that initially seems plausible is to construct an automaton that takes $m,n,z$ in parallel as input, and accepts if $z$ is the number of distinct values of $T(i,m,n)$ occurring over all $i$. If we had that, we could then accept those $(m,n)$ pairs corresponding to $z \\leq 2$. However, this is not possible; we show in Section~\\ref{diverse} that the number of distinct values taken by $T(i,m,n)$ for $m = n = F_{3j}/2$ is $\\Theta(j)$, where $F_t$ is the $t$'th Fibonacci number. This is impossible for an automaton that computes a function $z$ from inputs $m,n$ and accepts all three in parallel \\cite{Shallit:2021}. Instead we can use the balance criterion stated in Lemma~\\ref{lemma1}. This criterion is clearly expressible in first-order logic, since $x = \\lfloor n \\alpha \\rfloor$ is expressible. We can then translate this first-order statement into an appropriate automaton that takes $m$ and $n$ as input (in the Ostrowski $\\alpha$-numeration system) and accepts if and only if the $m \\times n$ blocks of the matrix $A$ are balanced. We therefore get our main result. \\begin{theorem} There is an algorithm that, given a quadratic irrational $\\alpha$ with $0 < \\alpha < 1$, constructs a finite automaton that takes as input pairs $(m,n)$, represented in the Ostrowski $\\alpha$-numeration system, and accepts if and only if the $m \\times n$ blocks of the Sturmian matrix ${\\cal A}_{\\alpha}$ are balanced. \\label{main} \\end{theorem} Let us now carry out this construction in {\\tt Walnut} for the Fibonacci word, where $\\alpha = (3-\\sqrt{5})/2$. We use the Zeckendorf numeration system \\cite{Lekkerkerker:1952,Zeckendorf:1972}, which represents integers as a sum of distinct Fibonacci numbers $F_j$. A representation of $n$ is written compactly as a binary word $e_i \\cdots e_2$, where $n = \\sum_{2 \\leq j \\leq i} e_j F_j$. To implement the criterion in Lemma~\\ref{lemma1}, we need to compute the difference $T(i+1,m,n)-T(i,m,n) \\in \\{ -1,0, 1\\}$. Unfortunately we cannot write $-1$ in the ordinary Zeckendorf numeration system in {\\tt Walnut}, since it only deals with natural numbers.\\footnote{Actually, the negaFibonacci system is implemented in {\\tt Walnut}, so we could have used that. But we stick with the Zeckendorf representation system because it is more familiar.} To get around this problem, we work with the quantity $$T(i+1,m,n)-T(i,m,n)+1 \\in \\{0,1,2 \\}$$ instead. The following {\\tt Walnut} code implements the criterion of Lemma~\\ref{lemma1}.\\footnote{For an introduction to {\\tt Walnut}, see the Appendix.} For more about {\\tt Walnut}, see \\cite{Mousavi:2016,Shallit:2023}. \\begin{verbatim} reg shift {0,1} {0,1} \"([0,0]|[0,1][1,1]*[1,0])*\": # accepts x,y such that y is the left shift of the bits of x def phin \"?msd_fib (n=0 & y=0) | Ez $shift(n-1,z) & y=z+1\": # (n,y) is accepted iff floor(n*phi) = y, where phi = (1+sqrt(5))/2 def alpha \"?msd_fib (n=0&z=0) | (n>0 & Ex $phin(n,x) & z+1+x=2*n)\": # z = floor (gamma*n), where gamma = (3-sqrt(5))/2 def diff \"?msd_fib Ea,b,c,d $alpha(i,a) & $alpha(i+m,b) & $alpha(i+n,c) & $alpha(i+m+n,d) & z+b+c=a+d+1\": # z = Delta(i,m,n) + 1 = T(i+1,m,n)-T(i,m,n)+1 def bal \"?msd_fib ~Ei,j i>0 & i<j & (($diff(i,m,n,2) & (Ak (i<k & k<j) => $diff(k,m,n,1)) & $diff(j,m,n,2)) | ($diff(i,m,n,0) & (Ak (i<k & k<j) => $diff(k,m,n,1)) & $diff(j,m,n,0)))\": # implements the balance criterion of Lemma 1 \\end{verbatim} This gives a $15$-state automaton {\\tt bal} that accepts exactly those $(m,n)$ pairs, in the Zeckendorf numeration system, that are balanced. An input consisting of a word made of pairs is accepted by the automaton if there is a path from state $0$ labeled with those pairs. See Figure~\\ref{fig1}. \\begin{figure}[htb] \\includegraphics[width=6.5in]{bal.pdf} \\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word.} \\label{fig1} \\end{figure} We have therefore shown \\begin{corollary} The automaton in Figure~\\ref{fig1} solves the balanced property for Fibonacci word rectangles. \\label{fibb} \\end{corollary} As an example, consider using the automaton to determine whether the $4 \\times 18$ blocks are balanced. We represent $4$ by $101$ in the Zeckendorf system and $18$ by $101000$. Padding the shorter with $0$ and entering the inputs in parallel $[0,1][0,0][0,1][1,0][0,0][1,0]$ into the automaton in Figure~\\ref{fig1}, we start at state $0$ and successively visit states $2, 6, 2, 7, 14$, and $7$ and accept. So $(m,n)$ is balanced. As a special case, we can now recover the theorem of Anselmo et al., as follows: \\begin{corollary} If $\\max(m,n)$ is a Fibonacci number then the $m \\times n$ matrices of ${\\cal A}_{\\gamma}$ are balanced. \\end{corollary} \\begin{proof} We use {\\tt Walnut}: \\begin{verbatim} reg isfib msd_fib \"0*10*\": # is input a Fibonacci number def max \"?msd_fib (z=m|z=n) & z>=m & z>=n\": # is z = max(x,y) eval anselmo \"?msd_fib Am,n,z ($max(m,n,z) & $isfib(z)) => $bal(m,n)\": # translation of their theorem \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} The {\\tt bal} automaton allows us to prove a wide variety of results about the $(m,n)$-balanced pairs for ${\\cal A}_{\\gamma}$. Here is one example. \\begin{proposition} Let $n \\geq 2$. \\begin{itemize} \\item[(a)] $(i,j)$ is balanced if and only if $(i',j)$ is balanced, for $F_{n+1} < i,i' < F_{n+2}$ and $j \\geq F_{n-1}$. \\item[(b)] $(F_{n+1} + i,j)$ is balanced if and only if $(F_{n+2} -i, j)$ is balanced, for $1 \\leq i < F_n$ and $j \\geq 1$. \\end{itemize} \\end{proposition} \\begin{proof} We use {\\tt Walnut}. For (a) we use the commands \\begin{verbatim} reg adjfib msd_fib msd_fib \"[0,0]*[0,1][1,0][0,0]*\": # accepts (F_n, F_{n+1}) for n>=2 eval claima \"?msd_fib Au,v,x,i,ip,j ($adjfib(u,v) & x=u+v & i>v & ip>v & i<x &ip<x & j>=v-u) => ($bal(i,j) <=> $bal(ip,j))\": # u = F_{n}, v = F_{n+1}, x = F_{n+2} \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. For (b) we use the commands \\begin{verbatim} eval claimb \"?msd_fib Au,v,x,i,j ($adjfib(u,v) & x=u+v & i>=1 & i<u & j>=1) => ($bal(v+i,j) <=> $bal(x-i,j))\": # u = F_n, v = F_{n+1}, x = F_{n+2} \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} We can also obtain a result about the density of balanced pairs $(m,n)$. \\begin{proposition} Suppose $F_i < m \\leq F_{i+1}$. Then for all $n\\geq 1$ there exists $j$, $1 \\leq j \\leq F_{i+1}$, such that $(m,n+j)$ is balanced. Furthermore the upper bound $F_{i+1}$ is optimal for each $m$. \\end{proposition} \\begin{proof} We use {\\tt Walnut}. \\begin{verbatim} eval density \"?msd_fib Am,x,y,n ($adjfib(x,y) & x<m & m<=y) => Ej j>=1 & j<=y & $bal(m,n+j)\": # x = F_i, y = F_{i+1} \\end{verbatim} which proves the first statement. To prove the second, we show that for each $m$ there exists $n$ such that the least $j\\geq 1$ with $(m,n+j)$ balanced is $\\geq F_{i+1}$. \\begin{verbatim} eval density2 \"?msd_fib Am,x,y ($adjfib(x,y) & x<m & m<=y) => (En Aj (j>=1 & j<y) => ~$bal(m,n+j))\": \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} These results essentially say that the density of $n$ for which $(m,n)$ is balanced is lower bounded by (approximately) $1 \\over {\\varphi m}$. \\section{Another version of the criterion for balance} We can obtain a more ``human readable'' version of the criterion for the $m \\times n$ submatrices of $A_{\\gamma}$ to be balanced, as follows: \\begin{theorem} Assume $m \\leq n$ and let the Zeckendorf expansion of $m$ (resp., $n$) be $F_{a_1} + \\dots + F_{a_k}$ (resp., $ F_{b_1} + \\dots + F_{b_\\ell}$) for $a_1 > \\cdots >a_k$ and $b_1 > \\cdots > b_\\ell$. Then $(m,n)$ is accepted by {\\tt bal} if and only if at least one of the following cases holds: \\begin{itemize} \\item[(a)] $m = 0$ or $m = 1$; \\item[(b)] $m = F_{a_1}$ and $a_1 \\notin \\{b_1, \\ldots, b_\\ell\\}$ and for $b_j > a_1 > b_{j+1}$ the indices $a_1$ and $b_j$ have the same parity; \\item[(c)] $m = F_{a_1}$ and $a_1 \\in \\{b_1, \\ldots, b_\\ell\\}$; \\item[(d)] $a_1 = b_\\ell$, (i.e., the largest Fibonacci number in the representation of $m$ is the smallest Fibonacci number in the representation of $n$) and $b_\\ell$ and $b_{\\ell-1}$ have distinct parities; \\item[(e)] $a_1 < b_\\ell$ (i.e., the largest Fibonacci number in the representation of $m$ is smaller than the smallest Fibonacci number in the representation of $n$). \\end{itemize} \\end{theorem} \\begin{proof} To find the characterization we traced the paths in the automaton in Figure~\\ref{fig:colored}, which is the automaton {\\tt bal} from Figure~\\ref{fig1} restricted to $m \\leq n$. \\begin{figure}[htb] \\includegraphics[width=6.5in]{bala_colored.pdf} \\caption{Automaton accepting balanced $(m,n)$ pairs for the Fibonacci word with $m \\leq n$.} \\label{fig:colored} \\end{figure} The {\\tt Walnut} code below verifies the characterization. Note that for simplicity, the regular expressions are not necessarily valid Zeckendorf representations. We can do this because eventually in {\\tt test} only the valid Zeckendorf representations are considered by {\\tt Walnut}. The mentioned colors are meant to help the interested reader find the paths in Figure~\\ref{fig:colored} corresponding to each regular expression. The ``upper part'' refers to the states $4,8$; the ``lower part'' to $2,5$ (and the state $10$ belongs to both). \\begin{verbatim} reg case_a msd_fib msd_fib \"([0,0]|[0,1])*|([0,0]|[0,1])*([1,0]|[1,1])\": reg case_b msd_fib msd_fib \"([0,0]|[0,1])*[0,1][0,0]([0,0][0,0])*[1,0]([0,0]|[0,1])*\": # lower part of red reg case_c msd_fib msd_fib \"([0,0]|[0,1])*[1,1]([0,0]|[0,1])*\": # dark blue, light blue, and the lower part of yellow reg case_d msd_fib msd_fib \"([0,0]|[0,1])*[0,1]([0,0][0,0])*[1,1]([0,0]|[1,0])*\": # upper part of yellow reg case_e msd_fib msd_fib \"([0,0]|[0,1])*([0,0]|[1,0])*\": # dark green, light green, and upper part of red eval test \"?msd_fib Am,n (m<=n) => (($case_a(m,n)|$case_b(m,n)|$case_c(m,n)|$case_d(m,n)|$case_e(m,n)) <=> $bal(m,n))\": \\end{verbatim} And {\\tt Walnut} returns {\\tt TRUE}. \\end{proof} \\section{Diverse rectangles} \\label{diverse} \\begin{theorem} Consider the word rectangles formed from the Fibonacci word $\\bf f$ with the indexing $f_0 f_1 f_2 \\cdots = 0100$. The number of distinct values of $T(i,m,n)$, taken over all $i$, for $m = n = F_{3k}/2$, is at least $k+1$. \\label{bnd} \\end{theorem} \\begin{proof} We claim that \\begin{align} T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2) - T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2) &= 2n \\label{t1} \\\\ T((F_{6n+5}-1)/4, F_{6n+3}/2, F_{6n+3}/2) - T((F_{6n+2}-1)/4, F_{6n+3}/2, F_{6n+3}/2) &= 2n+1. \\label{t2} \\end{align} To prove these claims we use {\\tt Walnut} and its capabilities of producing linear representations. A linear representation for a function $f(n)$ is a triple $(v,\\zeta, w)$ where $v$ is a row vector, $w$ is a column vector, and $\\zeta$ is a matrix-valued morphism, such that $f(n) = v \\zeta(x) w$ for all representations of $x$ that evaluate to $n$. In this case, of course, $x$ is a Zeckendorf representation. Let us verify Eq.~\\eqref{t1}. We define three functions, as follows: \\begin{itemize} \\item $f(F_{6n}) = T( (F_{6n+2}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$, and $f(t)= 0$ for all other $t$. \\item $g(F_{6n}) = T (( F_{6n-1}-1)/4, F_{6n}/2, F_{6n}/2)$ for $n \\geq 1$, and $g(t)= 0$ for all other $t$. \\item $h(F_{6n}) = 6n$ for $n \\geq 1$, and $h(t)= 0$ for all other $t$. \\end{itemize} Then Eq.~\\eqref{t1} is equivalent to the claim that $3f(t)-3g(t)-h(t) = 0$ for all $t$. Our strategy is to construct linear representations for each of the functions $f(t)$, $g(t)$, and $h(t)$, using {\\tt Walnut}, and then combine them to find a linear representation for $3f(t)-3g(t)-h(t)$. Consider the following code: \\begin{verbatim} reg fib6 msd_fib \"0*1(000000)*0000\": def cnt6a t \"?msd_fib $fib6(t) & Ex,y $adjfib(t,x) & $adjfib(x,y) & F[(y-1)/4+j+k]=@1 & j<t/2 & k<t/2\": # t = F_{6n}, x = F_{6n+1}, y = F_{6n+2} def cnt6b t \"?msd_fib $fib6(t) & Eu $adjfib(u,t) & F[(u-1)/4+j+k]=@1 & j<t/2 & k<t/2\": # t = F_{6n}, u = F_{6n-1} def numfib \"?msd_fib Ey $adjfib(x,y) & i<=y & $isfib(i)\": def numfib6 t \"?msd_fib $fib6(t) & $numfib(i,t)\": \\end{verbatim} Here \\begin{itemize} \\item {\\tt fib6} accepts the Zeckendorf expansion of $F_{6n}$ for $n \\geq 1$. \\item {\\tt cnt6a} generates a linear representation of rank $123$ for the function $f(t)$. \\item {\\tt cnt6b} generates a linear representation of rank $121$ for the function $g(t)$. \\item {\\tt numfib}$(i,x)$ accepts if and only if $x = F_n$ for some $n \\geq 2$ and $i=n$. \\item {\\tt numfib6} creates a linear representation of rank $14$ for the function $h(t)$. \\end{itemize} In {\\tt Walnut} these linear representations are provided as {\\tt Maple} files. From these linear representations we can easily compute, through standard matrix methods, a linear representation of rank $258 = 123 + 121 + 14$ for $3g(t) - 3f(t) - h(t)$. There is an algorithm to decide if a given linear representation represents the $0$ function \\cite{Berstel&Reutenauer:2011}. We use {\\tt Walnut} to create the representations and then a {\\tt Maple} program to check if $3f(t)-3g(t)-h(t)$ is identically $0$. This proves Eq.~\\eqref{t1}, and Eq.~\\eqref{t2} follows in a similar manner. \\end{proof} \\begin{corollary} The number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Theta(n)$. \\end{corollary} \\begin{proof} From a result of Berth\\'e and Tijdeman \\cite{Berthe} we know that the number of distinct values of $T(i,x,x)$ is $O(\\log x)$. From Theorem~\\ref{bnd} we know the number of distinct values of $T(i, F_{3n}/2, F_{3n}/2)$ is $\\Omega(n)$. Combining these gives the result. \\end{proof} \\section*{Acknowledgment} We acknowledge with thanks discussions with Narad Rampersad. \\begin{thebibliography}{10} \\expandafter\\ifx\\csname url\\endcsname\\relax \\def\\url#1{\\texttt{#1}}\\fi \\expandafter\\ifx\\csname doi\\endcsname\\relax \\def\\doi#1{\\burlalt{doi:#1}{http://dx.doi.org/#1}}\\fi \\expandafter\\ifx\\csname urlprefix\\endcsname\\relax\\def\\urlprefix{URL: }\\fi \\expandafter\\ifx\\csname href\\endcsname\\relax \\def\\href#1#2{#2}\\fi \\expandafter\\ifx\\csname burlalt\\endcsname\\relax \\def\\burlalt#1#2{\\href{#2}{#1}}\\fi \\bibitem{Allouche&Shallit:2003} J.-P. Allouche and J.~Shallit. \\newblock {\\em Automatic Sequences: Theory, Applications, Generalizations}. \\newblock Cambridge University Press, 2003. \\bibitem{Anselmo} M.~Anselmo, D.~Giammarresi, M.~Madonia, and C.~Selmi. \\newblock Fibonacci pictures on a binary alphabet. \\newblock In A.~Malcher and L.~Prigioniero, editors, {\\em DCFS 2025}, volume 15759 of {\\em Lecture Notes in Computer Science}, pages 1--16. Springer-Verlag, 2025. \\bibitem{Berstel:1986b} J.~Berstel. \\newblock Fibonacci words---a survey. \\newblock In G.~Rozenberg and A.~Salomaa, editors, {\\em The Book of L}, pages 13--27. Springer-Verlag, 1986. \\bibitem{Berstel&Reutenauer:2011} J.~Berstel and C.~Reutenauer. \\newblock {\\em Noncommutative Rational Series With Applications}, volume 137 of {\\em Encyclopedia of Mathematics and Its Applications}. \\newblock Cambridge Univ. Press, 2011. \\bibitem{Berstel&Seebold:2002} J.~Berstel and P.~{S\\'e\\'ebold}. \\newblock Sturmian words. \\newblock In M.~Lothaire, editor, {\\em Algebraic Combinatorics on Words}, pages 45--110. Cambridge University Press, 2002. \\bibitem{Berthe} V.~Berth{\\'e} and R.~Tijdeman. \\newblock Balance properties of multi-dimensional words. \\newblock {\\em Theoret. Comput. Sci.}, 273:197--224, 2002. \\bibitem{BrownT:1993} T.~C. Brown. \\newblock Descriptions of the characteristic sequence of an irrational. \\newblock {\\em Canad. Math. Bull.}, 36:15--21, 1993. \\bibitem{Bruyere&Hansel&Michaux&Villemaire:1994} V.~{Bruy\\`ere}, G.~Hansel, C.~Michaux, and R.~Villemaire. \\newblock Logic and $p$-recognizable sets of integers. \\newblock {\\em Bull. Belgian Math. Soc.}, 1:191--238, 1994. \\newblock Corrigendum, {\\it Bull.\\ Belgian\\ Math.\\ Soc.} {\\bf 1} (1994), 577. \\bibitem{Lekkerkerker:1952} C.~G. Lekkerkerker. \\newblock Voorstelling van natuurlijke getallen door een som van getallen van {Fibonacci}. \\newblock {\\em Simon Stevin}, 29:190--195, 1952. \\bibitem{Markovsky:2019} I.~Markovsky. \\newblock {\\em Low-Rank Approximation: Algorithms, Implementation, Applications}. \\newblock Springer-Verlag, 2nd edition, 2019. \\bibitem{Mousavi:2016} H.~Mousavi. \\newblock Automatic theorem proving in \\texttt{{{Walnut}}}. \\newblock ArXiv preprint arXiv:1603.06017 [cs.FL], 2016. \\newblock \\urlprefix\\url{http://arxiv.org/abs/1603.06017}. \\bibitem{Schaeffer&Shallit&Zorcic:2024} L.~Schaeffer, J.~Shallit, and S.~Zorcic. \\newblock Beatty sequences for a quadratic irrational: decidability and applications. \\newblock Arxiv preprint arXiv:2402.08331 [math.NT]. Available at \\url{https://arxiv.org/abs/2402.08331}, 2024. \\bibitem{Shallit:2021} J.~Shallit. \\newblock Synchronized sequences. \\newblock In T.~Lecroq and S.~Puzynina, editors, {\\em WORDS 2021}, volume 12847 of {\\em Lecture Notes in Computer Science}, pages 1--19. Springer-Verlag, 2021. \\newblock \\doi{10.1007/978-3-030-85088-3_1}. \\bibitem{Shallit:2023} J.~Shallit. \\newblock {\\em The Logical Approach To Automatic Sequences: Exploring Combinatorics on Words with {\\tt Walnut}}, volume 482 of {\\em London Mathematical Society Lecture Note Series}. \\newblock Cambridge University Press, 2023. \\bibitem{Vuillon:2003} L.~Vuillon. \\newblock Balanced words. \\newblock {\\em Bull. Belgian Math. Soc.}, 10(5):787--805, 12 2003. \\newblock \\doi{10.36045/bbms/1074791332}. \\bibitem{Zeckendorf:1972} E.~Zeckendorf. \\newblock {Repr\\'esentation} des nombres naturels par une somme de nombres de {Fibonacci} ou de nombres de {Lucas}. \\newblock {\\em Bull. Soc. Roy. {Li\\`ege}}, 41:179--182, 1972. \\end{thebibliography} \\appendix \\section{{\\tt Walnut} commands} The three principal {\\tt Walnut} commands used in this paper are \\begin{itemize} \\item {\\tt reg}: defines a regular expression; \\item {\\tt def}: defines an automaton for later use; \\item {\\tt def}: evaluates a first-order logical statement with no free variables as {\\tt TRUE} or {\\tt FALSE}. \\end{itemize} The jargon {\\tt ?msd\\_fib} at the beginning of a command tells {\\tt Walnut} that numbers are represented in the Zeckendorf numeration system. Logical AND $(\\wedge)$ is represented by {\\tt \\&}; logical OR $(\\vee)$ is represented by {\\tt |}; logical NOT $(\\neg)$ is represented by {\\tt \\char'176}; implication is represented by {\\tt =>}; and logical IFF is represented by {\\tt <=>}. The capital letter {\\tt A} is the universal quantifier $\\forall$; the capital letter {\\tt E} is the existential quantifier $\\exists$. Comments are denoted with the symbol {\\tt \\#}. When an automaton is defined as a function of its unbound variables, it may be reused and the order of the arguments is the alphabetical order of the variable names used when it was defined. The capital letter {\\tt F} refers to the Fibonacci word ${\\bf f} = 01001\\cdots$, indexed starting at $0$. \\end{document}"
}